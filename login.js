var _user={};_user.lUserId=-1;_user.strLoginId="";_user.strPassword="";_user.strEquipmentNo="";_user.strMobile="";_user.nTypeLogin=1;_user.nLogEntry=1;jsHeight.bodyheight();var _tags={};_tags.tag_1=["10"];_tags.tag_2=["20"];_tags.tag_3=["10","20"];function selectLoginRecord(b,a){$("#strUserName").val(b);$("#h1_img").html("<img id='userPhoto' src='"+a+"' />");$("#oclik_login").slideUp("slow");$("#img_a").attr("src","img/lo_Arrow.png");$(".lo_username").css("border-bottom","1px solid #D7D7D7");$("#oclik_login").css("border-bottom","0px")}function loginVersion(a){_shade_layer.show("登录中,请稍候......");if(a==1){loginToIndex()}else{EngineClass.info("请您重新输入1.0密码,再次登录进行1.0检测！！！");$("#pwd").val("");_shade_layer.hide();$("#islogintype").val(1)}}function clearArrayGesturePassword(b){var a=["",1];EngineClass.setArrayValue("gesturePasswordArray"+b,a)}function addDeviceLocalCahe(){setTimeout(function(){var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","addDeviceLocalCahe");a.setStringValue("strDeviceLocalCode",_user.strEquipmentNo);EngineClass.raiseTrans(a,"callBackForAddDeviceLocalCahe")},10)}function callBackForAddDeviceLocalCahe(b,c,a){}function delDeviceLocalCahe(){setTimeout(function(){var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","delDeviceLocalCahe");a.setStringValue("strDeviceLocalCode",_user.strEquipmentNo);EngineClass.raiseTrans(a,"callBackForDelDeviceLocalCahe")},10)}function callBackForDelDeviceLocalCahe(b,c,a){}function ssoLogin(){javascript:scrollTo(0,0);var c=$("#strUserName").val();var a=$("#pwd").val();if(""==c){info("用户名不能为空！");return}if(""==a){info("密码不能为空！");return}_user.strLoginId=trim(c);_user.strPassword=a;_user.nLogEntry=1;_shade_layer.show("登录中,请稍候......");var b=new CDO();b.setStringValue("strServiceName","UserService");b.setStringValue("strTransName","beforeLogin");b.setStringValue("strLoginId",_user.strLoginId);b.setStringValue("strPlatform",Math.random());EngineClass.raiseTrans(b,"callBackForBeforeLogin")}function callBackForBeforeLogin(g,h,a){if(a==undefined||a==null){_shade_layer.hide();EngineClass.info("请求失败!");return}if(a.nCode==0){var f=h.getStringValue("strRandom");var e=h.getStringValue("strSalt");var c=h.getIntegerValue("nRealLoginType");var d=hex_md5(e+""+hex_md5(_user.strPassword));var b=hex_md5(hex_md5(f)+""+d);_user.strLoginToken=b;EngineClass.getMobileBasicInfo()}else{if(a.nCode==302){var b=hex_md5(_user.strPassword);EngineClass.getMobileBasicInfo()}else{_shade_layer.hide();EngineClass.info(a.strText)}}}function ssoRegLogin(){var c=$("#strMobile").val();var a=$("#strPassword").val();_user.strLoginId=c;_user.strPassword=a;_user.nLogEntry=2;_shade_layer.show("登录中,请稍候......");var b=new CDO();b.setStringValue("strServiceName","UserService");b.setStringValue("strTransName","beforeLogin");b.setStringValue("strPlatform",Math.random());b.setStringValue("strLoginId",_user.strLoginId);EngineClass.raiseTrans(b,"callBackForBeforeLogin")}function callbackFunctionGetMobileBasicInfo(h,d,g,c,a,b,f){try{setTimeout(function(){var j=new CDO();j.setStringValue("strServiceName","UserService");j.setStringValue("strLoginId",_user.strLoginId);j.setStringValue("strLastLoginEquip",h);j.setStringValue("strLastLoginEquipId",d);j.setStringValue("strLastLoginEquipVersion",g);j.setStringValue("lLastLoginPosX",c);j.setStringValue("lLastLoginPosY",a);j.setStringValue("strEquipmentNo",b);j.setStringValue("strBaseStation",f);EngineClass.setStringValue("strLastLoginEquip",h);if(_user.nTypeLogin==1){var e=$("#islogintype").val();if(e==0){j.setStringValue("strTransName","APPLogin");j.setStringValue("strPassword",_user.strLoginToken);j.setStringValue("strPlatform","true");EngineClass.raiseTranshHttp(j,"callBackFordoLogin","http://ssomobile.dafy.com/handleTrans.cdo")}else{setTimeout(function(){EngineClass.openLoginWindow(_user)},300)}}else{j.setStringValue("strTransName","unlock");EngineClass.raiseTranshHttp(j,"callBackFordoLogin2","http://ssomobile.dafy.com/handleTrans.cdo")}},10)}catch(i){_shade_layer.hide();EngineClass.info("请求失败!");return}}function callBackFordoLogin(b,g,k){if(k==undefined||k==null){_shade_layer.hide();EngineClass.info("请求失败!！！！");return}if(k.nCode==0){if(g.exists("cdoUser")){var i=g.getCDOValue("cdoUser");var d=i.getLongValue("lId");var m=i.getLongValue("lOldCustomerId");var c=i.getStringValue("strLoginId");var l=i.getStringValue("nProtocolState");var j=i.getStringValue("strName");var n=i.getStringValue("strMobile");var f=i.getStringValue("strEquipmentNo");var e=i.getStringValue("bIsSalesman");var h=i.getStringValue("bIsConStore");var a=i.getStringValue("nIdentityState");_user.strEquipmentNo=f;_user.lUserId=d;_user.strMobile=n;setStringValue("lUserId",d+"");setStringValue("strLoginId",c);setStringValue("strName",j);setStringValue("strMobile",n);setStringValue("nProtocolState",l);setStringValue("nIdentityState",a);setStringValue("lOldCustomerId",m);saveLoginInfo(c);if(e=="true"||h=="true"){_shade_layer.hide();_TTPopups.open2({content:"请选择版本",cancelBtn:"1.0",submitBtn:"2.0",closeCallBack:"loginVersion"})}else{loginToIndex()}}else{EngineClass.info("服务器响应失败")}}else{if(k.nCode==10){if(_user.nLogEntry==2){ssoRegLogin()}else{setTimeout(function(){EngineClass.openLoginWindow(_user)},300)}}else{if(k.nCode==100){_shade_layer.hide();EngineClass.info("您的账号未激活，请联系您的客户经理。nCode=100")}else{if(k.nCode==1000){_user.lUserId=g.getStringValue("lUserId");_user.strMobile=g.getStringValue("strMobile");_TTPopups.open2({content:"您的账号在另一台手机上登录</br>更换手机需要短信验证.",cancelBtn:"否",submitBtn:"是",closeCallBack:"replacementEquipment"})}else{EngineClass.info(k.getText())}}}}_shade_layer.hide()}function saveLoginInfo(c){var d=getArrayValue("arrayPhone");var a=new Array();a[0]=c;if(d!=null){for(var b=0;b<d.length;b++){if(d[b]!=c){a[b+1]=d[b]}}}EngineClass.setArrayValue("arrayPhone",a)}function callBackFordoLogin2(c,d,b){if(b==undefined||b==null){_shade_layer.hide();info("请求失败!");return}if(b.nCode==0){var e=getStringValue("lUserId");var a=getDeviceCode();_user.strEquipmentNo=a;_user.lUserId=e;EngineClass.setNotices(_user.lUserId+"",_tags.tag_2);addDeviceLocalCahe();EngineClass.openWindow("index.htm","首页","",2,"")}else{if(b.nCode==1000){_shade_layer.hide();_user.lUserId=getStringValue("lUserId");_user.strMobile=getStringValue("strMobile");_TTPopups.open2({content:"您的账号在另一台手机上登录</br>更换手机需要短信验证.",cancelBtn:"否",submitBtn:"是",closeCallBack:"replacementEquipment2"})}else{_shade_layer.hide();EngineClass.info(b.getText());setTimeout(function(){EngineClass.openWindow("login.htm","登录","",1,"")},1000)}}}function loginToIndex(){EngineClass.setNotices(_user.lUserId+"",_tags.tag_2);addDeviceLocalCahe();var a=EngineClass.getArrayValue("gesturePasswordArray"+_user.lUserId);if(isVarComplete(a)||a.length!=2||isVarComplete(a[0])){_shade_layer.hide();EngineClass.setStringGesturePassword();return}EngineClass.openWindow("index.htm","首页","",2,"")}function checkVersionByGesture(){try{_shade_layer.show("登录中,请稍候......");_user.strLoginId=getStringValue("strLoginId");_user.nTypeLogin=2;setTimeout(function(){EngineClass.getMobileBasicInfo()},10)}catch(a){_shade_layer.hide();EngineClass.info("请求失败!");return}}function confirmationBox(a){if(a==1){$(".cd-popup").removeClass("is-visible");EngineClass.openWindow("reEquNo.htm","更换设备","lUserId="+_user.lUserId+"&strMobile="+_user.strMobile,2,"")}else{if(a==2){$(".cd-popup").removeClass("is-visible")}}}function replacementEquipment(a){if(a==1){setTimeout(function(){EngineClass.openWindow("reEquNo.htm","更换设备","lUserId="+_user.lUserId+"&strMobile="+_user.strMobile,2,"")},1000)}}function replacementEquipment2(a){if(a==1){setTimeout(function(){openWindow("reEquNo.htm","更换设备","lUserId="+_user.lUserId+"&strMobile="+_user.strMobile,2,"")},1000)}else{setTimeout(function(){openWindow("login.htm","登录","",2,"")},1000)}}function callBackOpenLoginWindow(a,d,c,b){if(a=="0"){setStringValue("lUserId",d+"");setStringValue("strLoginId",c);EngineClass.setNotices(d+"",_tags.tag_1);_shade_layer.hide();EngineClass.openIndexWindow()}else{if(a=="1"){_shade_layer.hide();info(b)}else{_shade_layer.hide();info("用户登录异常,请联系客服！")}}}function toRegister(){EngineClass.openWindow("register.htm","注册","",0,"")}function toRetrievePassword(){EngineClass.openWindow("myCenter/securityCenter/retrievePasswordFirst.htm","找回密码","",0,"")};