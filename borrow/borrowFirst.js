var lBuyerId=0;var nIsLoadedCity=0;var lBorrowCredit=0;var lUsedCredit=0;var lRemainCredit=0;var lRepayDay=0;var strSelectProductId="";jsHeight.bodyheight();jQuery(document).ready(function(){_shade_layer.show("加载中,请稍候...");var a=getQueryString("pageFrom");if(a=="0"){setBackURL("index.htm","首页","",0,"")}else{if(a=="1"){setBackURL("myCenter/myBorrow/repaymentList.htm","还款列表","",0,"")}}lBuyerId=getStringValue("lUserId");lBuyerId=Number(lBuyerId);loadCreditOtherInfoByUserId();loadCreditInfoByUserId();loadBorrowList();jQuery("#btToBorrowList").click(function(){openWindow("borrow/borrowList.htm","借款列表","",0)})});function backUrl(){var a=getQueryString("pageFrom");if(a=="0"){openWindow("index.htm","首页","",0,"",1)}else{if(a=="1"){openWindow("myCenter/myBorrow/repaymentList.htm","还款列表","",0,"",1)}else{if(a=="2"){openWindow("myCenter/myIndex.htm","我的","",0,"",1)}else{openWindow("borrow/borrowFirstNoCredit.htm","无权限展示","pageFrom=0",0,"",1)}}}}function toBorrow(c,d,b){var a=getStringValue("nGrantState");if(a=="3"){info("您的授信被终止,请联系客服:400-625-9898");return false}else{if(a=="0"){info("您还没有授信,请联系客服:400-625-9898");return false}else{if(a=="1"){info("您的授信已经过期,请联系客服:400-625-9898");return false}}}if(lRemainCredit<100){info("剩余额度小于一百,无法借款!");return false}openWindow("borrow/borrowSecond.htm","去借款","BorrowId="+c+"&nHaier="+d+"&lendProduct="+b,0)}function loadCreditOtherInfoByUserId(){var a=new CDO();a.setStringValue("strServiceName","BorrowerService");a.setStringValue("strTransName","getGrant");a.setLongValue("lUserId",lBuyerId);raiseTrans(a,"callBackForGCOI")}function callBackForGCOI(g,h,b){if(b==undefined||b==null){return false}if(b.nCode==-90000){info(b.strText);return false}if(b.nCode!=0||!h.exists("cdoGrant")){info(b.strText);return}var d=h.getCDOValue("cdoGrant");var e=d.getStringValue("nGrantState");setStringValue("nGrantState",e);var f="";var a="";var c="";if(!d.exists("dtGrantTimeBegin")||!d.exists("nAppointRepayDate")||!d.exists("dtGrantTimeEnd")){}else{f=d.getStringValue("dtGrantTimeBegin").substr(0,10);c=d.getStringValue("nAppointRepayDate");lRepayDay=c;setStringValue("lRepayDay",lRepayDay);a=d.getStringValue("dtGrantTimeEnd").substr(0,10)}jQuery("#nAppointRepayDate").html("每月"+c+"日");jQuery("#dtGrantTime").html(f+"&nbsp;&nbsp;至&nbsp;&nbsp;"+a)}function loadCreditInfoByUserId(){var a=new CDO();a.setStringValue("strServiceName","CreditService");a.setStringValue("strTransName","queryCredit");a.setLongValue("lUserId",lBuyerId);raiseTrans(a,"callBackForGCBI")}function callBackForGCBI(g,h,b){if(b==undefined||b==null||b.nCode!=0||!h.exists("cdoCredit")){jQuery("#remainLimit").html(fmoney(lRemainCredit.toFixed(0),2)+"元");jQuery("#creditLimit").html(fmoney(lBorrowCredit.toFixed(0),2)+"元");return false}var d=h.getCDOValue("cdoCredit");var c=0;if(!d.exists("lCreditBalance")||!d.exists("lCreditAvailable")||!d.exists("lCreditUsed")){jQuery("#remainLimit").html(fmoney(lRemainCredit.toFixed(0),2)+"元");jQuery("#creditLimit").html(fmoney(lBorrowCredit.toFixed(0),2)+"元");return false}try{lBorrowCredit=(checkNumberVariable(d.getStringValue("lCreditBalance"))/100);lUsedCredit=(checkNumberVariable(d.getStringValue("lCreditUsed"))/100);lRemainCredit=(checkNumberVariable(d.getStringValue("lCreditAvailable"))/100);setStringValue("lRemainCredit",lRemainCredit.toString());jQuery("#remainLimit").html(fmoney(lRemainCredit.toFixed(0),2)+"元");jQuery("#creditLimit").html(fmoney(lBorrowCredit.toFixed(0),2)+"元");var a=(checkNumberVariable(d.getStringValue("lCreditBalance0"))/100);var j=(checkNumberVariable(d.getStringValue("lCreditBalance1"))/100);jQuery("#lCreditBalance0").html(fmoney(a.toFixed(0),3)+"元");jQuery("#lCreditBalance1").html(fmoney(j.toFixed(0),3)+"元")}catch(f){info("获取信用额度失败!")}}function fmoney(b,d){d=d>0&&d<=20?d:2;b=parseFloat((b+"").replace(/[^\d\.-]/g,"")).toFixed(d)+"";var a=b.split(".")[0].split("").reverse(),c=b.split(".")[1];t="";for(i=0;i<a.length;i++){t+=a[i]+((i+1)%3==0&&(i+1)!=a.length?",":"")}return t.split("").reverse().join("")}function loadBorrowList(){var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","getBorrowProductListForMobile");raiseTrans(a,"callBackForLBL")}function callBackForLBL(b,f,a){try{if(a==undefined||a==null||f==null){info("暂无借款产品！");return false}if(a.nCode!=0||!f.exists("cdosBorrowProduct")){info("暂无借款产品！");return false}var c=f.getCDOArrayValue("cdosBorrowProduct");if(c.length>0){var d=c[0];if(d==null||d==undefined||!d.exists("strRepayWay")||!d.exists("nBorrowerMonthRate")||!d.exists("nDays")||!d.exists("lId")||!d.exists("byRepayWay")){return false}for(var h=0;h<c.length;h++){var m=c[h].getLongValue("lId");var o=c[h].getLongValue("nHaier");if(o==1){$("#toHED").attr("onclick","toBorrow("+m+","+o+",'')").show();$("#HEDtitle").html("还款方式：按月付服务费，到期还本付息")}else{var j=c[h].getStringValue("strRepayWay");var g=c[h].getStringValue("byRepayWay");var p=checkNumberVariable(c[h].getStringValue("nBorrowerMonthRate"));var l=checkNumberVariable(c[h].getStringValue("nDays"));var n=checkNumberVariable(c[h].getStringValue("lId"));setStringValue("strSelectRepayWay",g);setStringValue("strSelectStrRepayWay",j);setStringValue("strSelectBorrowerMonthRate",p);setStringValue("strSelectDays",l);setStringValue("strSelectProductId",n);$("#toXJD").attr("onclick","toBorrow("+m+","+o+",'"+g+"')");$("#XJDtitle").html("还款方式：按月付息到期还本")}}setTimeout(function(){$("#container").css({display:"block",overflow:"visible"})},500)}height_public("body",0)}catch(k){jQuery("#borrowListArea").html("暂无借款产品！")}finally{$("#container").show();_shade_layer.hide()}}function afterLoad(){_loading.hide();jQuery("#container").css("display","block")}function stagespopup(){document.ontouchmove=function(a){a.preventDefault()};document.getElementById("fin_i_table_list").style.display="block";document.getElementById("black_stages_overlayasd").style.display="block"}function stages_close(){document.ontouchmove=function(a){};document.getElementById("fin_i_table_list").style.display="none";document.getElementById("black_stages_overlayasd").style.display="none"};