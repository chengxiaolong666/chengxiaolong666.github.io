var strSelectRepayWay="";var strSelectStrRepayWay="";var strSelectBorrowerMonthRate="";var strSelectDays="";var lRepayDay=0;var nHaier=getQueryString("nHaier");jQuery(document).ready(function(){if(1==nHaier){HaiErRepayPlan()}else{loadData()}});function loadData(){strSelectRepayWay=getStringValue("strSelectRepayWay");strSelectStrRepayWay=getStringValue("strSelectStrRepayWay");lRepayDay=checkNumberVariable(getStringValue("lRepayDay"));strSelectBorrowerMonthRate=checkNumberVariable(getStringValue("strSelectBorrowerMonthRate"));var h=(strSelectBorrowerMonthRate/100);strSelectDays=checkNumberVariable(getStringValue("strSelectDays"));var m=0;var j=0;var d=checkNumberVariable(getQueryString("repayPrincipal"));var v="";var n=new Date();var e=n.getFullYear();var a=n.getMonth();var s=n.getDate();var l=parseInt(strSelectDays/30)+1;var p=0;if(lRepayDay>s){p=a}else{p=a+1}var c=new Date(e,p,lRepayDay);var o=addDate(n.valueOf(),(strSelectDays-1));var r=Number(getTermByFirstAndLastTime(c,o,l));for(var t=0;t<r;t++){v=v+"<li>";var q=0;var u=0;if(t==0){q=1+DateDiff((e+"-"+(a+1)+"-"+s),(c.Format("yyyy-MM-dd")));v=v+"<span class='schedule_name'>还款日："+c.Format("yyyy-MM-dd")+"</span>"}else{if((t==(r-1))){if(lRepayDay>s){q=DateDiff((new Date(e,(a+t-1),lRepayDay)).Format("yyyy-MM-dd"),(o.Format("yyyy-MM-dd")))}else{q=DateDiff((new Date(e,(a+t),lRepayDay)).Format("yyyy-MM-dd"),(o.Format("yyyy-MM-dd")))}v=v+"<span class='schedule_name' style='padding-top:2%;'>还款日："+o.Format("yyyy-MM-dd")+"</span>"}else{var g="";var b;if(lRepayDay>s){g=new Date(e,(a+t),lRepayDay);b=a+t}else{g=new Date(e,(a+t+1),lRepayDay);b=a+t+1}var k=g.getMonth();var f=new Date(e,b-1,lRepayDay).Format("yyyy-MM-dd");q=DateDiff(f,g.Format("yyyy-MM-dd"));v=v+"<span class='schedule_name'>还款日："+g.Format("yyyy-MM-dd")+"</span>"}}u=(d*(h/30)*q).toFixed(2);j=checkNumberVariable(j)+checkNumberVariable(u);if((t==(r-1))){v=v+"<span class='schedule_money'>本金："+d+"元<br/>利息："+u+"元</span>"}else{v=v+"<span class='schedule_money'>利息："+u+"元</span>"}v=v+"</li>"}m=(checkNumberVariable(d)+checkNumberVariable(j)).toFixed(2);j=j.toFixed(2);jQuery("#repayTotal").html(m+"");jQuery("#repayPrincipal").html(d);jQuery("#interest").html(j+"");jQuery("#dataShow").html(v+"");jQuery("#nowDate").html(n.Format("yyyy-MM-dd"))}function getTermByFirstAndLastTime(e,c,f){var b=2;for(var d=1;d<=f;d++){var a=new Date(e.getFullYear(),(e.getMonth()+d),e.getDate());if(DateDiff2(a.Format("yyyy-MM-dd"),(c.Format("yyyy-MM-dd")))<0){b=b+1}else{break}}return b}function Repay(){this.serviceMoney=0;this.repayDays=0;this.repayDate=null}var repayConsts={};repayConsts.totalMoney=0;repayConsts.interest=0;repayConsts.repayDay=checkNumberVariable(getStringValue("lRepayDay"));repayConsts.principal=checkNumberVariable(getQueryString("repayPrincipal"));repayConsts.interestRate=0.13;repayConsts.serviceMoneyRate=0.29;repayConsts.deadline=90;repayConsts.serviceMoney=0;function HaiErRepayPlan(){var f=new Date();var j=new Repay();var g=new Repay();var a=0;var b="";var k=0;repayConsts.interest=getInterest().toFixed(2);g.repayDate=new Date(f.getTime()+repayConsts.deadline*24*3600*1000);if(f.getDate()>repayConsts.repayDay){j.repayDate=new Date(f.getFullYear(),f.getMonth()+1,repayConsts.repayDay);j.repayDays=daysBetween(j.repayDate.Format("yyyy-MM-dd"),f.Format("yyyy-MM-dd"))}else{j.repayDate=new Date(f.getFullYear(),f.getMonth(),repayConsts.repayDay);j.repayDays=repayConsts.repayDay-f.getDate()}var d=parseInt(repayConsts.deadline/30)+1;a=Number(getTermByFirstAndLastTime(j.repayDate,g.repayDate,d));for(var h=0;h<a;h++){var c=0;b=b+"<li>";if(h==0){b=b+"<span class='schedule_name'>还款日："+j.repayDate.Format("yyyy-MM-dd")+"</span>";c=getServiceMoney(j);k+=checkNumberVariable(c.toFixed(2))}else{if(h==(a-1)){if(g.repayDate.getDate()>repayConsts.repayDay){g.repayDays=g.repayDate.getDate()-repayConsts.repayDay}else{g.repayDays=daysBetween(getPreMonth(new Date(g.repayDate.getFullYear(),g.repayDate.getMonth(),repayConsts.repayDay).Format("yyyy-MM-dd")),g.repayDate.Format("yyyy-MM-dd"))}c=getServiceMoney(g);k+=checkNumberVariable(c.toFixed(2));b=b+"<span class='schedule_name' style='padding-top:4%;'>还款日："+g.repayDate.Format("yyyy-MM-dd")+"</span>";b=b+"<span class='schedule_money'>本金："+repayConsts.principal+"元<br>利息："+repayConsts.interest+" 元<br>"}else{var e=new Repay();e.repayDate=new Date(j.repayDate.getFullYear(),j.repayDate.getMonth()+h,repayConsts.repayDay);e.repayDays=daysBetween(getPreMonth(new Date(e.repayDate.getFullYear(),e.repayDate.getMonth(),repayConsts.repayDay).Format("yyyy-MM-dd")),e.repayDate.Format("yyyy-MM-dd"));c=getServiceMoney(e);k+=checkNumberVariable(c.toFixed(2));b=b+"<span class='schedule_name'>还款日："+e.repayDate.Format("yyyy-MM-dd")+"</span>"}}if(h==(a-1)){b=b+"服务费："+c.toFixed(2)+"元</span>"}else{b=b+"<span class='schedule_money'>服务费："+c.toFixed(2)+"元</span>"}b=b+"</li>"}repayConsts.serviceMoney=k.toFixed(2);repayConsts.totalMoney=(checkNumberVariable(repayConsts.serviceMoney)+checkNumberVariable(repayConsts.interest)+checkNumberVariable(repayConsts.principal)).toFixed(2);jQuery("#serviceMoneyDiv").show();jQuery("#repayServiceMoney").html(repayConsts.serviceMoney+"");jQuery("#repayTotal").html(repayConsts.totalMoney+"");jQuery("#repayPrincipal").html(repayConsts.principal);jQuery("#interest").html(repayConsts.interest+"");jQuery("#dataShow").html(b+"");jQuery("#nowDate").html(f.Format("yyyy-MM-dd"))}function getServiceMoney(a){return repayConsts.principal*(repayConsts.serviceMoneyRate/360*a.repayDays)}function getInterest(){return repayConsts.principal*(repayConsts.interestRate/360*repayConsts.deadline)}function daysBetween(g,c){var f=g.substring(5,g.lastIndexOf("-"));var b=g.substring(g.length,g.lastIndexOf("-")+1);var i=g.substring(0,g.indexOf("-"));var h=c.substring(5,c.lastIndexOf("-"));var d=c.substring(c.length,c.lastIndexOf("-")+1);var e=c.substring(0,c.indexOf("-"));var a=((Date.parse(f+"/"+b+"/"+i)-Date.parse(h+"/"+d+"/"+e))/86400000);return Math.abs(a)}function getPreMonth(b){var e=b.split("-");var g=e[0];var f=e[1];var i=e[2];var j=new Date(g,f,0);j=j.getDate();var c=g;var k=parseInt(f)-1;if(k==0){c=parseInt(c)-1;k=12}var h=i;var a=new Date(c,k,0);a=a.getDate();if(h>a){h=a}if(k<10){k="0"+k}var d=c+"-"+k+"-"+h;return d};