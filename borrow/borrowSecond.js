var BorrowId=getQueryString("BorrowId");var nHaier=getQueryString("nHaier");var lBuyerId=0;var lRemainCredit=0;var strSelectRepayWay="";var strSelectStrRepayWay="";var strSelectBorrowerMonthRate="";var strSelectDays="";var strSelectProductId="";var isCheckXieYi_1=true;var isCheckXieYi_2=true;jsHeight.bodyheight();if(nHaier==1){$("#haerxieyi1").show();$("#haerxieyi2").show();$("#moneyValidateShow").html("贷款发放日起，开始计算服务费、利息")}else{var lendProduct=getQueryString("lendProduct");if(lendProduct==5||lendProduct=="5"){$("#xianjinxieyi1_new").show()}else{$("#xianjinxieyi1").show()}$("#xianjinxieyi2").show();$("#moneyValidateShow").html("贷款发放日起，开始计算利息")}jQuery(document).ready(function(){setTimeout(function(){lBuyerId=getStringValue("lUserId");lBuyerId=Number(lBuyerId);clearArray(["accountInfo","currentBorrow"]);loadBorrowInfo();var a=getInfoModel(nHaier);$("#WborrowApplyDetail").html(a);loadBankInfoByUserId()},300)});function getInfoModel(a){var b="";if(a==1){b='<span class="row_name">还款方式:</span><span class="row_sum">按月付服务费到期还本付息</span></br><span class="row_name">期限:</span><span class="row_sum" >90天</span></br><span class="row_name">日服务费率:</span><span class="row_sum">0.806‰</span></br><span class="row_name">日利息:</span><span class="row_sum" >0.361‰</span></br><span class="row_name">收款账户:</span><span class="row_sum" id="accountInfo"></span></br>'}else{b='<span class="row_name">还款方式:</span><span class="row_sum">按月付息到期还本</span></br><span class="row_name">期限:</span><span class="row_sum" >90天</span></br><span class="row_name">日综合费率:</span><span class="row_sum">1.167‰</span></br><span class="row_name">收款账户:</span><span class="row_sum" id="accountInfo"></span></br>'}return b}function loadBorrowInfo(){lRemainCredit=checkNumberVariable(getStringValue("lRemainCredit"));jQuery("#moneyInto").attr("placeholder","您当前最多能借"+lRemainCredit+"元")}function loadBankInfoByUserId(){var a=new CDO();a.setStringValue("strServiceName","BorrowerService");a.setStringValue("strTransName","getBankBaseInfo");a.setLongValue("lUserId",lBuyerId);raiseTrans(a,"callBackForGB")}function callBackForGB(f,g,b){if(b==undefined||b==null||b.nCode!=0||!g.exists("cdoBank")){return false}var a=g.getCDOValue("cdoBank");var d="";var c="";if(!a.exists("strBankName")||!a.exists("strBankcardNo")){}else{d=a.getStringValue("strBankName");c=a.getStringValue("strBankcardNo")}var e=d+"("+c.substr((c.length-4),4)+")";setStringValue("accountInfo",e);jQuery("#accountInfo").html(e)}function verifyBorrowMoney(){var a=jQuery("#moneyInto").val();a=richTextInputEncoder(a);jQuery("#moneyInto").val(a);if(a==""){info("借款金额必填!");return false}if(isNaN(a)){info("借款金额必须是数字!");return false}if(a<100){info("借款金额不能小于一百!");return false}if(a>lRemainCredit){info("借款金额不能大于可借额度!");return false}if(a%100!=0){info("借款金额需要是 100 的倍数!");return false}if(a>100000!=0){info("借款金额不能超过10万!");return false}return true}var isClickBorrow=false;function doBorrow(){javascript:scrollTo(0,0);setTimeout(function(){if(!isCheckXieYi_1||!isCheckXieYi_2){info("请选中协议!");return}if(verifyBorrowMoney()){if(!isClickBorrow){isClickBorrow=true;verifyProtocol()}}},300)}function verifyProtocol(){var a=new CDO();a.setStringValue("strServiceName","BorrowerService");a.setStringValue("strTransName","getProtocol");a.setLongValue("lUserId",Number(lBuyerId));raiseTrans(a,"callBackVerifyProtocol")}function callBackVerifyProtocol(b,c,a){if(a==undefined||a==null||a.nCode!=0||!c.exists("cdoProtocol")||c.getCDOValue("cdoProtocol").getIntegerValue("nProtocolState")==10){isClickBorrow=false;_TTPopups.open2({content:"借款前需要签订代扣协议",cancelBtn:"取消",submitBtn:"前往",closeCallBack:"TT_pay_dk_1"});return false}applyLoanFromMobile()}function TT_pay_dk_1(a){if(a==1){isClickBorrow=false;callProtocol(1,"","product/productDetail.htm")}}function applyLoanFromMobile(){var a=new CDO();a.setStringValue("strServiceName","RichScanService");a.setStringValue("strTransName","isSetPwd");a.setLongValue("lUserId",lBuyerId);raiseTrans(a,"callBackForisSetPwd1")}function callBackForisSetPwd1(c,e,a){if(a==null||a==undefined){info("验证支付密码通讯失败");return false}if(a.nCode==0){isClickBorrow=false;var d="请输入支付密码";var b="借款金额:"+jQuery("#moneyInto").val()+"元";openPayWindow(d,b,"","",false,"callbackFunctionOpenPayPasswordWindow1")}else{if(a.nCode==2){_TTPopups.open2({content:"您没有设置支付密码,去设置",cancelBtn:"取消",submitBtn:"确定",closeCallBack:"toPwdSet"})}else{isClickBorrow=false;info(a.strText)}}}function callbackFunctionOpenPayPasswordWindow1(c,b){if(b==0){return false}strPwd=c;var a=new CDO();a.setStringValue("strServiceName","RichScanService");a.setStringValue("strTransName","isRightPwd");a.setStringValue("strPayPassword",hex_md5(c+""));a.setLongValue("lUserId",lBuyerId);raiseTrans(a,"callBackForisRightPwd1")}function callBackForisRightPwd1(b,c,a){if(a==null||a==undefined){isClickBorrow=false;info("验证支付密码通讯失败");return false}if(a.nCode==0){payNDeposit(strPwd)}else{if(a.nCode==1){isClickBorrow=false;payPwdPutError(a.strText)}else{isClickBorrow=false;info(a.strText)}}}function payNDeposit(d){var a=d;if($.trim(a).length==6&&!isNaN(Number(a))){var c=new CDO();c.setStringValue("strServiceName","BorrowIntentService");c.setStringValue("strTransName","applyLoanFromMobile");c.setStringValue("lProductId",BorrowId);c.setStringValue("strPayPassword",hex_md5(d+""));var b=checkNumberVariable(jQuery("#moneyInto").val())*100;c.setStringValue("lAmount",b+"");raiseTrans(c,"callBackApplyLoanFromMobile")}else{info("支付密码验证错误")}}function callBackApplyLoanFromMobile(b,c,a){if(a==undefined||a==null){isClickBorrow=false;info("网络异常！");return false}if(a.nCode==0){openWindow("borrow/borrowResult.htm","借款结果","repayPrincipal="+jQuery("#moneyInto").val(),1)}else{isClickBorrow=false;info(a.strText);return false}}function toPwdSet(a){if(a==0){return false}isClickBorrow=false;openDelayWindow("myCenter/securityCenter/payPwdSet.htm","设置支付密码","",0)}var isClickPlan=false;function doRepayPlan(){if(!a){var a=true;if(verifyBorrowMoney()){openWindow("borrow/RepaymentPlan.htm","还款计划","nHaier="+nHaier+"&repayPrincipal="+jQuery("#moneyInto").val()+"&BorrowId="+BorrowId,0)}}}function controlXX(a){if(a.value==""){document.getElementById("elementXX").style.display="none"}else{document.getElementById("elementXX").style.display="block"}}function toBorrowDetail(){if(nHaier==1){openWindow("borrow/borrow02details.htm","详情页","",0)}else{openWindow("borrow/borrow01details.htm","详情页","",0)}}function changePic(b,a){var c=b.src;if(c.indexOf("dx_02.png")>-1){b.src="../img/public/dx_01.png";if(a==1){isCheckXieYi_1=false}if(a==2){isCheckXieYi_2=false}}else{b.src="../img/public/dx_02.png";if(a==1){isCheckXieYi_1=true}if(a==2){isCheckXieYi_2=true}}};