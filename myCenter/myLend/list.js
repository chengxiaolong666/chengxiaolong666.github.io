var _obj={};_obj.lUserId=0;_obj.nState=2;_obj.lLendId="";_obj.nHoldControlType="";_obj.nIsHaveDataBefore=true;jsHeight.bodyheight();_obj.hideDivId={"1":"hide_div_buy_id","2":"hide_div_hold_id","4":"hide_div_ransom_id"};_obj.ulId={"1":"ul_buy_id","2":"ul_hold_id","4":"ul_ransom_id"};_obj.pageIndex=0;_obj.pageSize=10;_obj.asynFlag=true;_obj.loadFlag=true;window.onload=function(){setBackURL("myCenter/myIndex.htm","首页","",1,"",1);var a=getStringValue("lUserId");if(isNaN(a)){info("非法登录，用户信息有误！");return false}a=Number(a);_obj.lUserId=checkNumberVariable(a);_obj.nState=getStringValue("nState")||2;if(_obj.nState==4){var e=_obj.get("a_hold_id");e.className="";var c=_obj.get("a_ransom_id");c.className="row";var d=_obj.get("ul_hold_id").parentNode;_obj.show(d,false);var b=_obj.get("ul_ransom_id").parentNode;_obj.show(b,true);_obj.show("ul_ransom_id",true)}clearArray(["nState"]);_obj.loadEarnings();_obj.loadNumber();_obj.loadList()};_obj.loadEarnings=function(){_shade_layer.show("加载中,请稍候......");var a=new CDO();a.setStringValue("strServiceName","LendIntentService");a.setStringValue("strTransName","getLendFundSummaryInfo");a.setLongValue("lLenderId",Number(_obj.lUserId));raiseTrans(a,"callBackLoadEarnings")};function callBackLoadEarnings(c,d,b){if(b==undefined||b==null){return false}if(b.nCode==0&&d.exists("lTotalInterest")&&d.exists("lTotalInvest")){var e=d.getStringValue("lTotalInterest")||0;var a=d.getStringValue("lTotalInvest")||0;_obj.html("lTotalInterest_id",e);_obj.html("lTotalInterest_id_2",e);_obj.html("lTotalInvest_id",a);_obj.html("lTotalInvest_id_2",a)}}_obj.loadNumber=function(){var a=new CDO();a.setStringValue("strServiceName","LendIntentService");a.setStringValue("strTransName","getLendIntentSummaryInfo");a.setLongValue("lLenderId",Number(_obj.lUserId));raiseTrans(a,"callBackLoadNumber")};function callBackLoadNumber(d,f,c){if(c==undefined||c==null){return false}var a=0;var b=0;var e=0;if(c.nCode==0&&f.exists("nBoughtCount")&&f.exists("nOverCount")&&f.exists("nBuyingCount")){a=Number(f.getStringValue("nBoughtCount"));b=Number(f.getStringValue("nOverCount"));e=Number(f.getStringValue("nBuyingCount"))}_obj.html("nBoughtCount_id",a);_obj.html("nOverCount_id",b);_obj.html("nBuyingCount_id",e);if(_obj.nState==2){_obj.total=a}else{if(_obj.nState==4){_obj.total=b}else{_obj.total=e}}}_obj.loadList=function(){_obj.asynFlag=false;var b=new CDO();if(!_obj.nIsHaveDataBefore){return false}var a=_obj.pageIndex*_obj.pageSize;b.setStringValue("strServiceName","LendIntentService");if(_obj.nState==4){b.setStringValue("strTransName","getRedemptionListForMobile")}else{if(_obj.nState==2){b.setStringValue("strTransName","getLendIntentListForMobile");b.setIntegerValue("nState",Number(_obj.nState))}else{b.setStringValue("strTransName","getBuyingLendIntentForMobile")}}b.setIntegerValue("nRecordOffset",a);b.setIntegerValue("nPageSize",_obj.pageSize);b.setLongValue("lLenderId",Number(_obj.lUserId));raiseTrans(b,"callBackGeneratePage")};function callBackGeneratePage(h,K,B){var a=_obj.get(_obj.ulId[_obj.nState]);if(B==undefined||B==null){info("请求加载列表失败!");_shade_layer.hide();return false}if(B.nCode!=0){info(B.strText);_shade_layer.hide();return false}if(_obj.pageIndex==0){a.innerHTML=""}if(B.nCode==0){var E="";if(_obj.nState==2){if(!K.exists("cdosLendIntentList")){return false}E=K.getCDOArrayValue("cdosLendIntentList")}else{if(_obj.nState==4){if(!K.exists("cdosRedemptionList")){return false}E=K.getCDOArrayValue("cdosRedemptionList")}else{if(!K.exists("cdosLendIntentList")){return false}E=K.getCDOArrayValue("cdosLendIntentList")}}var e=_obj.get(_obj.hideDivId[_obj.nState]);if(E.length<1){_obj.nIsHaveDataBefore=true;if(_obj.pageIndex==0){_Not.show(a.id,"暂无数据","../../");_obj.show(a,true)}}else{var D="";for(var J=0;J<E.length;J++){var w=e.innerHTML;var b=E[J];var z=b.getStringValue("lId");var F=b.getStringValue("strLendProductName");var x=b.exists("strDisplayRate")?b.getStringValue("strDisplayRate"):"";var L="";if(b.exists("nLendExtRate")){if(checkNumberVariable(b.getStringValue("nLendExtRate"))!=0){L=" + "+(checkNumberVariable(b.getStringValue("nLendExtRate"))/100)+"%"}}var d=(checkNumberVariable(b.getStringValue("lAmount"))/100).toFixed(2);var C="";w=w.replace("#strLendProductName#",F);w=w.replace("#nLenderYearRate#",x);w=w.replace("#nLendExtRate#",L);w=w.replace("#amount#",d);var G="";if(_obj.nState==4){var y="0";C=b.getStringValue("lId");y=b.exists("nModel")?b.getIntegerValue("nModel"):"0";C=C+"_"+y;var r=b.getStringValue("nState")+"";var v="";if(r=="1"){v="赎回中";G=b.getStringValue("strExpireTime")}else{v="已赎回";G=b.getStringValue("strDoneDateTime")}w=w.replace("#nState#",v)}else{if(_obj.nState==2){C=b.getStringValue("lRedemptionId");G=b.getStringValue("dtCreateTime");var m=Number(b.getStringValue("nDayUnit"));var o=Number(b.getStringValue("nDayCount"));var k=false;var H=0;if(m==2){H=365*o}else{if(m==1){H=30*o}else{H=o}}var j=m=="2"?"年":(m=="1"?"个月":"天");var A=b.getStringValue("nDayCount")+j;w=w.replace("#nTermCount#",A);var u=Number(b.getStringValue("nContinue"));var n=Number(b.getStringValue("nFixed"));var q=b.getStringValue("nApplyRedemption");var s=b.getStringValue("nCanRedemptFlag");if(n==0&&s=="1"&&q=="0"){var g="赎回";var I=0;w='<div class="fin_i_ransom fin_ran_bagcolor circumference" onclick="_obj.btnEvent(\''+I+"','"+z+"','"+F+"','"+d+"')\">"+g+"</div>"+w}if(n==0&&s=="1"&&q=="1"){w=w.replace("#descriptionArea#",'<div class="fin_i_accomplish circumference" \')">已经申请赎回</div>')}else{w=w.replace("#descriptionArea#","")}var p="0";if(b.exists("nCancelContinueFlag")){p=b.getStringValue("nCancelContinueFlag")}if(u==1&&n==1&&p=="1"){var g="取消续投";var I=1;w='<div class="fin_i_ransom fin_ran_bagcolor circumference" onclick="_obj.btnEvent(\''+I+"','"+z+"','"+F+"','"+d+"')\">"+g+"</div>"+w}var c="0";var l="0";if(b.exists("nCanCash")){c="1";l=b.getStringValue("nCanCash")}var t="0";if(b.exists("nCash")){t=b.getStringValue("nCash")}if(l=="1"){var g="取现";var I=2;if(t=="1"){w='<div class="fin_i_ransom fin_wklc_disable_bagcolor circumference">'+g+"</div>"+w;w=w.replace('style="display:none"',"");w=w.replace("#wkContent#","您有一笔取现申请中,请等待完成。")}else{if(t=="2"){w='<div class="fin_i_ransom fin_wklc_disable_bagcolor circumference">'+g+"</div>"+w;w=w.replace('style="display:none"',"");w=w.replace("#wkContent#","您本月份的取现机会已经使用。")}else{w='<div class="fin_i_ransom fin_ran_bagcolor circumference" onclick="_obj.btnEvent(\''+I+"','"+z+"','"+F+"','"+d+"')\">"+g+"</div>"+w}}}}else{G=b.getStringValue("dtCreateTime")}}w=w.replace("#time#",G.length>10?G.substr(0,10):G);w=w.replace("#onclick#","_obj.openDetail('"+z+"','"+C+"','"+q+"','"+c+"')");var f="<li>"+w+"</li>";D=D+f}jQuery(a).append(D);_obj.show(a,true)}if(_obj.pageIndex*_obj.pageSize>=_obj.total){_obj.loadFlag=false}else{_obj.pageIndex=_obj.pageIndex+1}_obj.asynFlag=true}_shade_layer.hide()}_obj.chooice=function(e,f,h){if(_obj.asynFlag==false){info("正在加载数据，请不要频繁点击！");return false}_obj.pageIndex=0;_obj.nState=f;_obj.loadFlag=true;_obj.asynFlag=true;_obj.nIsHaveDataBefore=true;var j=e.className;if(j=="row"){return}var g=document.getElementsByName("tab");for(var d=0;d<g.length;d++){g[d].className=""}e.className="row";for(var b in _obj.hideDivId){var l=_obj.hideDivId[b];var a=_obj.get(l).parentNode;if(l==h){_obj.show(a,true)}else{_obj.show(a,false)}}var c=_obj.get(_obj.ulId[_obj.nState]);c.innerHTML="";_obj.loadEarnings();_obj.loadNumber();_obj.loadList()};_obj.openDetail=function(f,a,e,c){var d=new Array();d=a.split("_");a=d[0];var b=d[1];if(b=="1"||b==1){setStringValue("lLendIntentId",f);openWindow("myCenter/myLend/ransomQxDetail.htm","悟空理财赎回详情","",0);return false}else{if(a!=0){setStringValue("lRansomId",a);openWindow("myCenter/myLend/ransomDetail.htm","理财赎回详情","",0);return false}else{if(_obj.nState==2){if(c=="0"){setStringValue("strLendType",_obj.nState);setStringValue("lLendId",f);openWindow("myCenter/myLend/lendDetail.htm","理财详情","",0);return false}else{if(c=="1"){setStringValue("strLendType",_obj.nState);setStringValue("lLendIntentId",f);openWindow("myCenter/myLend/lendDetail_wk.htm","悟空理财详情","",0);return false}}}}}};var strActionState=0;_obj.btnEvent=function(e,d,a,b){if(strActionState==1){info("目前正在处理业务，请稍候！");return false}strActionState=1;_obj.lLendId=d;if(e==0){_obj.nHoldControlType="0";var c=new CDO();c.setStringValue("strServiceName","LendIntentService");c.setStringValue("strTransName","getLendRedemptDataByIdForMobile");c.setLongValue("lLenderId",Number(_obj.lUserId));c.setLongValue("lId",_obj.lLendId);raiseTrans(c,"callBackGetLendRedemptDataByIdForMobile")}else{if(e==2){setStringValue("lLendIntentId",d);setStringValue("strLendProductName",a);openWindow("myCenter/myLend/wklc_enchashment.htm","悟空取现","",0)}else{_obj.nHoldControlType="1";_TTPopups.open2({content:"您确认取消"+a+" 理财产品的续投意向",cancelBtn:"否",submitBtn:"是",closeCallBack:"validatePassIfSet"})}}event.stopPropagation()};var strLendProductlId=0;var strLendProductName="";var strExpireTime="";var nPenaltyRate=0;var lExpectRdptAmount=0;function callBackGetLendRedemptDataByIdForMobile(b,d,a){if(a==undefined||a==null){strActionState=0;info("请求获取申请赎回信息失败");return false}if(a.nCode!=0){strActionState=0;info("获取申请赎回信息失败："+a.strText);return false}if(!d.exists("cdoRecord")||!d.getCDOValue("cdoRecord").exists("nPenaltyRate")||!d.getCDOValue("cdoRecord").exists("lExpectRdptAmount")||!d.getCDOValue("cdoRecord").exists("lId")||!d.getCDOValue("cdoRecord").exists("strLendProductName")||!d.getCDOValue("cdoRecord").exists("strExpireTime")){strActionState=0;info("获取申请赎回信息失败："+a.strText);return false}var c=d.getCDOValue("cdoRecord");strLendProductlId=c.getStringValue("lId");strLendProductName=c.getStringValue("strLendProductName");strExpireTime=c.getStringValue("strExpireTime");nPenaltyRate=c.getStringValue("nPenaltyRate");lExpectRdptAmount=c.getStringValue("lExpectRdptAmount");_TTPopups.open2({content:"您确认提交"+strLendProductName+" 理财产品的赎回申请,预期赎回时间："+strExpireTime+",预期赎回金额:"+(Number(lExpectRdptAmount)/100)+",服务费率:"+(Number(nPenaltyRate)/100)+"%",cancelBtn:"否",submitBtn:"是",closeCallBack:"validatePassIfSet"})}function validatePassIfSet(a){if(a=="0"){strActionState=0;return false}checkIsPayPwd("readyOpenPayWindow")}function readyOpenPayWindow(){try{openNewPayWindow("请输入支付密码",true,"validatePass2")}catch(a){info("调用显示支付密码失败！"+a);strActionState=0}}function validatePass2(b,a){if(a==0){strActionState=0}else{var c=new CDO();c.setStringValue("strServiceName","CustomerService");c.setStringValue("strTransName","verifyPayPassword");c.setLongValue("lUserId",_obj.lUserId);c.setStringValue("strPayPassword",b);raiseTrans(c,"callBackValidatePass")}}function callBackValidatePass(b,c,a){if(a==null||a.getCode()!=0){if(a!=null&&a.getCode()==1){payPwdPutError(a.strText);strActionState=0;return}strActionState=0;info("您输入的支付密码有误，请核实后重试！");return false}disposeHolding()}var disposeHolding=function(){if(_obj.nHoldControlType=="1"){var a=new CDO();a.setStringValue("strServiceName","LendIntentService");a.setStringValue("strTransName","stopLendLoop");a.setLongValue("lLenderId",_obj.lUserId);a.setLongValue("lLendIntentId",_obj.lLendId);raiseTrans(a,"callBackstopLendLoop")}else{var a=new CDO();a.setStringValue("strServiceName","LendIntentService");a.setStringValue("strTransName","applyForRedemption");a.setLongValue("lLenderId",_obj.lUserId);a.setLongValue("lLendIntentId",_obj.lLendId);raiseTrans(a,"callBackApplyForRedemption")}};function callBackstopLendLoop(b,c,a){strActionState=0;if(a==undefined||a==null){info("请求失败");return false}if(a.nCode!=0){info("取消续投失败："+a.strText);return false}info("取消成功！");initializeParameter();openWindow("myCenter/myLend/list.htm","理财列表","","1","")}function callBackApplyForRedemption(c,d,a){strActionState=0;if(a==undefined||a==null){info("请求失败!");return false}if(a.nCode!=0){info("赎回失败："+a.strText);return false}var b=d.getLongValue("lId");setStringValue("lRansomId",b);openWindow("myCenter/myLend/ransomDetail.htm","理财赎回详情","",0)}_obj.ret=function(a,b){if(a==undefined||a==null){b("info:"+b);return false}if(a.nCode!=0){b(a.strText);return false}};_obj.get=function(a){return document.getElementById(a)};_obj.show=function(c,b){if((typeof c==="string")&&c.constructor==String){c=document.getElementById(c)}if(c){var a=b==true?"block":"none";c.style.display=a}};_obj.html=function(b,a){if((typeof b==="string")&&b.constructor==String){b=document.getElementById(b)}if(b){b.innerHTML="";b.innerHTML=a}};$(document).scroll(function(){var b=$(this).scrollTop();var a=$(document).height();var c=$(this).height();if(b+c>=a){if(_obj.asynFlag==true&&_obj.loadFlag==true){_obj.loadList()}}});function Integer(a){if(window.innerHeight){winHeight=window.innerHeight}else{if((document.body)&&(document.body.clientHeight)){winHeight=document.body.clientHeight}}if(window.innerWidth){winWidth=window.innerWidth}else{if((document.body)&&(document.body.clientWidth)){winWidth=document.body.clientWidth}}winWidth=winWidth+"px";winHeight=winHeight+"px";var a=document.getElementById(a);a.setAttribute("style","width:"+winWidth+";height:"+winHeight+";position: absolute;left:0px; top:0px; background: #000; opacity: 0.5; z-index: 1000;")}function stagespopup(){document.ontouchmove=function(a){a.preventDefault()};document.getElementById("fin_i_table_list").style.display="block";document.getElementById("black_stages_overlayasd").style.display="block"}function stages_close(){document.ontouchmove=function(a){};document.getElementById("fin_i_table_list").style.display="none";document.getElementById("black_stages_overlayasd").style.display="none"}function initializeParameter(){_obj.nState=2;_obj.lLendId="";_obj.nHoldControlType="";_obj.pageIndex=0;_obj.asynFlag=true;_obj.loadFlag=true};