var payType=0;var strAccountName="";var nBankcardState="";var strBankCode="";var strBankName="";var strBranchName="";var strBankcardNo="";var strAffiliatedBankNo="";var strProtocolCode="";var lUserId="";var strName="";var strLoginId="";var strPlatform=1;var backType="";var minMoney=0.1;var depositMoney="0";var kValue=0;var dValue=0;var dfenable=1;var nQPModel=0;var lThirdId=0;jsHeight.bodyheight();$(document).ready(function(){_shade_layer.show("努力加载中,请稍候...");setTimeout(function(){$("#content").show();_shade_layer.hide()},5000);var b=document.getElementById("app_bj_raw");FastClick.attach(b);b.addEventListener("click",function(d){backPage()},false);var a=getStringValue("backURL");if(a!="myBorrow"){if(a==null||a==undefined||a==""){setBackURL("myCenter/myIndex.htm","我的","",1,"","1")}else{setBackURL(a,"","",1,"","1")}}lUserId=Number(getStringValue("lUserId"));strLoginId=getStringValue("strLoginId");strName=getStringValue("strName");strPlatform=getChannelType();var c=new CDO();c.setStringValue("strServiceName","BorrowerService");c.setStringValue("strTransName","getBankBaseInfo");c.setLongValue("lUserId",lUserId);raiseTrans(c,"callBackForgetBankBaseInfo");var c=new CDO();c.setStringValue("strServiceName","AccountUserBIQueryService");c.setStringValue("strTransName","getAccountAmount");c.setLongValue("lUserId",lUserId);raiseTrans(c,"callBackForgetAccountAmount")});function queryBankLimit(b,c){var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","getThirdBankLimit");a.setLongValue("strCode",b);a.setIntegerValue("nProtocolState",c);raiseTrans(a,"callBackBankWithholdLimit")}function callBackBankWithholdLimit(b,c,a){if(a.nCode==0){var e=c.getStringValue("strDKValue");var l=c.getLongValue("lDKValue");var k=c.getStringValue("strKJValue");var g=c.getLongValue("lKJValue");dValue=l==0?9999999999:l;kValue=g==0?9999999999:g;var i=b.getIntegerValue("nProtocolState");var f=c.getIntegerValue("DKEnable");var j=c.getIntegerValue("QPEnable");dfenable=c.getIntegerValue("DFEnable");lThirdId=c.exists("lThirdId")?c.getIntegerValue("lThirdId"):99;nQPModel=c.exists("nQPModel")?c.getIntegerValue("nQPModel"):99;if(i=="90"||i=="100"){if(f==1){var h='<div class="kj_cz_list">代扣支付</div><div class="kj_cz_right">'+strBankNameALL+"("+strBankcardNo1All+")<p>"+e+"</p></div>";$("#cardInfo").append(h);rech_list($("#daikou"),0)}else{$("#daikou").hide();$("#duihao0").hide();payType=1}if(j==1){var d='<div class="kj_cz_list">快捷支付</div><div class="kj_cz_right">'+strBankNameALL+"("+strBankcardNo1All+")<p>"+k+"</p></div>";$("#cardInfo1").append(d);if(f==0){rech_list($("#kuaijie"),1)}}else{$("#kuaijie").hide();$("#duihao1").hide();payType=2}}else{$("#daikou").hide();$("#duihao0").hide();rech_list($("#kuaijie"),1);if(j==1){var h='<div class="kj_cz_list">快捷支付</div><div class="kj_cz_right">'+strBankNameALL+"("+strBankcardNo1All+")<p>"+k+"</p></div>";$("#cardInfo1").append(h)}else{$("#kuaijie").hide();$("#duihao1").hide();payType=2}}$("#bank_name").html("").append(strBankNameALL);$("#card_no").html("").append(strBankcardNo_1ALL);getBankLogo(strBankCodeAll);$("#content").show();_shade_layer.hide()}else{info("获取银行卡限额异常");$("#content").show();_shade_layer.hide()}}var strBankNameALL="";var strBankcardNo1All="";var strBankcardNo_1ALL="";var strBankCodeAll="";function callBackForgetBankBaseInfo(i,d,b){if(b==null||b==undefined){info("获取银行卡信息通讯失败");return false}if(b.nCode==0){var a=d.getIntegerValue("nRecordCount");if(a==1){var g=d.getCDOArrayValue("cdoBank");strAccountName=g.getStringValue("strAccountName");nBankcardState=g.getStringValue("nBankcardState");strBankCode=g.getStringValue("strBankCode");strBankName=g.getStringValue("strBankName");strBranchName=g.getStringValue("strBranchName");strBankcardNo=g.getStringValue("strBankcardNo");strProtocolCode=g.getStringValue("nProtocolState");var f=strBankcardNo.length;var h=strBankcardNo.substr(f-4,f);var e=strBankcardNo.substr(f-4,f);var c=strBankcardNo.substr(0,f-8);queryBankLimit(strBankCode,strProtocolCode);strBankNameALL=strBankName;strBankcardNo1All=h;strBankcardNo_1ALL=c+"****"+e;strBankCodeAll=strBankCode}else{info("无银行卡数据")}}else{info(b.strText)}}function callBackForgetAccountAmount(d,e,a){if(a==null||a==undefined){info("通讯失败");return false}if(a.nCode==0){var c=0;if(e.exists("cdoAccountAmount")){var b=e.getCDOValue("cdoAccountAmount");c=b.getLongValue("lAvailablebalance1")}$("#bottom_balance").html("");$("#bottom_balance").append("账户余额：<span>"+c/100+"</span>元");$("#all_money").html("");$("#all_money").append(c/100)}else{info(a.strText)}}var flag=true;$("#recharg_submit").click(function(){try{document.getElementById("app_screen01").style.display="block";var a=$("#totalMony1").val();if(!verifyDate(a,"充值金额不能为空")){return false}if(a<minMoney){info("您输入充值金额不正确!");document.getElementById("app_screen01").style.display="none";return false}var d=/^\d+$|^\d+\.\d{0,1}$/;if(!(d.test(a))){info("您输入充值金额不正确!");document.getElementById("app_screen01").style.display="none";return false}$(".z_correctSvg").each(function(){if($(this).css("display")!="none"){payType=$(this).attr("typeS")}});if(payType==0){if(Number(a)<Number(minMoney)||Number(a)>Number(dValue)){info("您充值的金额已超过最大限额");document.getElementById("app_screen01").style.display="none";return false}}else{if(payType==1){if(Number(a)<Number(minMoney)||Number(a)>Number(kValue)){info("您充值的金额已超过最大限额");document.getElementById("app_screen01").style.display="none";return false}}else{info("该银行通道暂时不可用,请联系营业员！");document.getElementById("app_screen01").style.display="none";return false}}if(!verifyDate(strBankName,"银行名称不能为空")){return false}if(!verifyDate(strBankcardNo,"银行卡号不能为空")){return false}if(!verifyDate(lUserId,"用户ID不存在")){return false}if(!verifyDate(strLoginId,"登录名不存在")){return false}if(flag==false){info("请勿重复提交");return}flag=false;var c=new CDO();c.setStringValue("strServiceName","RichScanService");c.setStringValue("strTransName","isSetPwd");c.setLongValue("lUserId",lUserId);raiseTrans(c,"callBackForisSetPwd")}catch(b){document.getElementById("app_screen01").style.display="none";flag=true}});function callBackForisSetPwd(d,e,a){document.getElementById("app_screen01").style.display="none";if(a==null||a==undefined){info("验证支付密码通讯失败");flag=true;return false}if(a.nCode==0){var c=$("#totalMony1").val();var b="充值金额:"+Number(c)+"元";openPayWindow("请输入支付密码",b,"","",false,"callbackFunctionOpenPayPasswordWindow")}else{if(a.nCode==2){_TTPopups.open2({content:"您没有设置支付密码,去设置",cancelBtn:"取消",submitBtn:"确定",closeCallBack:"toPwdSet"})}else{info(a.strText)}}flag=true}var pwdword="";function callbackFunctionOpenPayPasswordWindow(c,b){document.getElementById("app_screen01").style.display="none";if(b==0){flag=true;return false}var a=new CDO();a.setStringValue("strServiceName","RichScanService");a.setStringValue("strTransName","isRightPwd");a.setStringValue("strPayPassword",hex_md5(c+""));a.setLongValue("lUserId",Number(lUserId));setTimeout(function(){pwdword=c;raiseTrans(a,"callBackForisRightPwd")},50)}function callBackForisRightPwd(d,e,a){document.getElementById("app_screen01").style.display="none";if(a==null){info("验证支付密码通讯失败");flag=true;return false}if(a.nCode==0){$(".z_correctSvg").each(function(){if($(this).css("display")!="none"){payType=$(this).attr("typeS")}});if(payType==0){var b=$("#totalMony1").val();var c=new CDO();c.setStringValue("strServiceName","FundService");c.setStringValue("strTransName","addRecharge");c.setLongValue("lUserId",lUserId);c.setStringValue("strLoginId",strLoginId);c.setStringValue("strUserName",strName);c.setLongValue("lPrice",parseFloat((b*100).toFixed(2)));c.setStringValue("strBranchName",strBranchName);c.setStringValue("strBankCode",strBankCode);c.setStringValue("strBankName",strBankName);c.setStringValue("strBankcardNo",strBankcardNo);c.setStringValue("strAccountName",strAccountName);c.setIntegerValue("nFundType",1);c.setIntegerValue("strPlatform",strPlatform);c.setStringValue("strPayPassword",hex_md5(pwdword+""));raiseTrans(c,"callBackForrechargeAdd")}else{if(payType==1){var b=$("#totalMony1").val();var c=new CDO();c.setStringValue("strServiceName","FundService");c.setStringValue("strTransName","addRechargeFastPayment");c.setLongValue("lUserId",lUserId);c.setStringValue("strLoginId",strLoginId);c.setStringValue("strUserName",strName);c.setLongValue("lPrice",parseFloat((b*100).toFixed(2)));c.setStringValue("strBranchName",strBranchName);c.setStringValue("strBankCode",strBankCode);c.setStringValue("strBankName",strBankName);c.setStringValue("strBankcardNo",strBankcardNo);c.setStringValue("strAccountName",strAccountName);c.setIntegerValue("nFundType",1);c.setIntegerValue("strPlatform",strPlatform);c.setStringValue("strPayPassword",hex_md5(pwdword+""));c.setLongValue("lThirdId",lThirdId);c.setIntegerValue("nModeType",nQPModel);raiseTrans(c,"callBackForaddRechargeFastPayment")}}}else{if(a.nCode==1){payPwdPutError(a.strText)}else{info(a.strText)}}flag=true}$("#total_roll").click(function(){var d=document.getElementById("all_money").innerText;d=(Number(d));depositMoney=(Number(d));if(dfenable==0){info("该银行通道暂时不可用,请联系营业员！");return false}if(!depositMoney){info("您的余额不足,不能提现！");return false}var c="请输入支付密码";var a="提现金额:"+d+"元";var b=new CDO();b.setStringValue("strServiceName","RichScanService");b.setStringValue("strTransName","isSetPwd");b.setLongValue("lUserId",lUserId);raiseTrans(b,"callBackForisSetPwd1")});function callBackForisSetPwd1(c,e,a){document.getElementById("app_screen01").style.display="none";if(a==null||a==undefined){info("验证支付密码通讯失败");return false}if(a.nCode==0){var d="请输入支付密码";var b="提现金额:"+depositMoney+"元";openPayWindow(d,b,"","",false,"callbackFunctionOpenPayPasswordWindow1")}else{if(a.nCode==2){_TTPopups.open2({content:"您没有设置支付密码,去设置",cancelBtn:"取消",submitBtn:"确定",closeCallBack:"toPwdSet"})}else{info(a.strText)}}}function callbackFunctionOpenPayPasswordWindow1(c,b){if(b==0){flag=true;return false}strPwd=c;var a=new CDO();a.setStringValue("strServiceName","RichScanService");a.setStringValue("strTransName","isRightPwd");a.setStringValue("strPayPassword",hex_md5(c+""));a.setLongValue("lUserId",lUserId);pwdword=c;raiseTrans(a,"callBackForisRightPwd1")}function callBackForisRightPwd1(b,c,a){document.getElementById("app_screen01").style.display="none";if(a==null||a==undefined){info("验证支付密码通讯失败");flag=true;return false}if(a.nCode==0){payNDeposit(strPwd)}else{if(a.nCode==1){payPwdPutError(a.strText)}else{info(a.strText)}}flag=true}function payNDeposit(c){var a=c;if($.trim(a).length==6&&!isNaN(Number(a))){var b=new CDO();b.setStringValue("strServiceName","FundService");b.setStringValue("strTransName","addWithdrawal");b.setLongValue("lUserId",lUserId);b.setStringValue("strLoginId",strLoginId);b.setStringValue("strUserName",strName);b.setLongValue("lPrice",parseFloat((depositMoney*100).toFixed(2)));b.setStringValue("strBranchName",strBranchName);b.setStringValue("strBankCode",strBankCode);b.setStringValue("strBankName",strBankName);b.setStringValue("strBankcardNo",strBankcardNo);b.setStringValue("strAccountName",strAccountName);b.setStringValue("strPayPassword",hex_md5(pwdword+""));b.setIntegerValue("nFundType",2);b.setIntegerValue("strPlatform",strPlatform);raiseTrans(b,"callBackForDepositAdd")}else{info("支付密码验证错误")}}function callBackForDepositAdd(b,c,a){if(a==null||a==undefined){info("通讯失败");document.getElementById("app_screen01").style.display="none";return false}if(a.nCode==0){openDelayWindow("myCenter/recharge/depositSucceed.htm","提现成功","",0)}else{info(a.strText);document.getElementById("app_screen01").style.display="none"}}function callBackForaddRechargeFastPayment(e,f,b){document.getElementById("app_screen01").style.display="none";if(b==null||b==undefined){info("通讯失败");flag=true;return false}if(b.nCode==0){if(nQPModel==1){var a=f.getStringValue("strOrderSn");var d="strOrderSn="+a+"&lThirdId="+lThirdId;setStringValue("payTypeTo","0");setTimeout(function(){openDelayWindow("myCenter/recharge/financial_code.htm","快捷支付",d,1)},200)}else{if(nQPModel==2){var c=f.getStringValue("sdkData");strSN=f.getStringValue("strSN");EngineClass.clientTollPay("callBackSdkData",c)}else{info("快捷模式不可用，请联系营业员！")}}}else{info(b.strText)}flag=true}function callBackSdkData(b,d,a){info(a);var c=new CDO();c.setStringValue("strServiceName","BusinessCallService");c.setStringValue("strTransName","setSDKReturnState");c.setStringValue("strSN",strSN);c.setLongValue("lThirdId",lThirdId);c.setStringValue("strAppResultCode",b);c.setStringValue("strAppResultDesc",a);c.setStringValue("retCode",d);raiseTrans(c,"callBackSetSDKReturnState")}function callBackSetSDKReturnState(c,e,a){var d=c.getStringValue("retCode");var b=c.getStringValue("strAppResultCode");if(d!=1){document.getElementById("app_screen01").style.display="none";flag=true;openDelayWindow("myCenter/recharge/rechargeSucceed.htm","充值成功","payType=0",1,"")}flag=true}function callBackForrechargeAdd(b,c,a){if(a==null||a==undefined){info("通讯失败");document.getElementById("app_screen01").style.display="none";return false}if(a.nCode==0){setTimeout(function(){openDelayWindow("myCenter/recharge/rechargeSucceed.htm","充值成功","payType=0",1,"")},200)}else{info(a.strText);document.getElementById("app_screen01").style.display="none"}flag=true}function verifyDate(b,a){if(null==b||b==undefined||$.trim(b).length==0){info(a);document.getElementById("app_screen01").style.display="none";return false}return true}function backPage(){var a=getStringValue("backURL");if(a=="myBorrow"){back()}else{if(a==null||a==undefined||a==""){openDelayWindow("myCenter/myIndex.htm","","",1,"","1")}else{openDelayWindow(a,"","",1,"","1")}}}function toPwdSet(a){if(a==1){openDelayWindow("myCenter/securityCenter/payPwdSet.htm","设置支付密码","",0);setTimeout(function(){$(".api_Eject_c").remove();$("#fade1234").remove()},500)}}$("#inc_submit").click(function(){try{document.getElementById("app_screen01").style.display="block";var b=$("#totalMony2").val();if(dfenable==0){info("该银行通道暂时不可用,请联系营业员！");document.getElementById("app_screen01").style.display="none";return false}b=(Number(b));depositMoney=b;if(!depositMoney){info("请您填写要提现的金额！");document.getElementById("app_screen01").style.display="none";return false}var f=document.getElementById("all_money").innerText;f=(Number(f));if(!verifyDate(b,"提现金额不能为空")){return false}var a=/^\d+(\.\d{1,2})?$/;if(!a.test(b)){info("您输入的金额格式不正确!");document.getElementById("app_screen01").style.display="none";return false}if(b<0){info("请输入大于0的提现金额!");document.getElementById("app_screen01").style.display="none";return false}if(b>f){info("您输入的提现金额超过可提现金额!");document.getElementById("app_screen01").style.display="none";return false}if(!verifyDate(strBankName,"银行名称不能为空")){return false}if(!verifyDate(strBankcardNo,"银行卡号不能为空")){return false}if(!verifyDate(lUserId,"用户ID不存在")){return false}if(!verifyDate(strLoginId,"登录名不存在")){return false}var d=new CDO();d.setStringValue("strServiceName","RichScanService");d.setStringValue("strTransName","isSetPwd");d.setLongValue("lUserId",lUserId);raiseTrans(d,"callBackForisSetPwd1")}catch(c){document.getElementById("app_screen01").style.display="none"}});function rech_list(e,d){payType=d;var b=document.getElementById("bank_option");var a=b.getElementsByTagName("li");if(d==0){$("#daikouTishi").show()}else{$("#daikouTishi").hide()}for(var c=0;c<a.length;c++){if(c==d){a[c].childNodes[1].className="zsczde_regist clearfix";$(a[c]).find(".z_correctSvg").show()}else{a[c].childNodes[1].className="zsczde_regist clearfix";$(a[c]).find(".z_correctSvg").hide()}}}function getBankLogo(b){var a="";a="../../img/banklogo/logo"+b+".png";$("#bank_logo").attr("src",a)};