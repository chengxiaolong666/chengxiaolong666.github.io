var repayment_pay={};repayment_pay.lId="";repayment_pay.customerId="";repayment_pay.userName="";repayment_pay.repayType="";repayment_pay.applyId="";repayment_pay.repayDate="";repayment_pay.preAmount="";repayment_pay.totalAmount="";repayment_pay.interest="";repayment_pay.breachMoney="";jsHeight.bodyheight();window.onload=function(){_shade_layer.show("努力加载中,请稍候...");setTimeout(function(){repayment_pay.lId=getQueryString("lId");repayment_pay.strVersionType=getQueryString("strVersionType");repayment_pay.repayType=getQueryString("repayType");repayment_pay.repayDate=getQueryString("repayDate");repayment_pay.applyId=getQueryString("applyId");repayment_pay.userName=getStringValue("strMobile");repayment_pay.customerId=getStringValue("lOldCustomerId");var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","getTotalRepaymentInfo");a.setStringValue("applyId",repayment_pay.lId);a.setStringValue("customerId",repayment_pay.customerId);a.setStringValue("userName",repayment_pay.userName);raiseTrans(a,"callBackForTotalRepaymentInfo")},300)};function callBackForTotalRepaymentInfo(c,d,a){if(a==undefined||a==null){_shade_layer.hide();info("请求失败!");return false}if(a.nCode==0){var b=d.getCDOValue("totalRepaymentInfo");$("#jk_money").val(b.getStringValue("principal"));$("#dh_money").val(b.getStringValue("laveMoney"));repayment_pay.preAmount=b.getStringValue("laveMoney");repayment_pay.totalAmount=b.getStringValue("principal")}_shade_layer.hide()}var repay=function(){var d=$("#jk_money").val();var a=$("#dh_money").val();var c=$("#hk_money").val();var b=/^^[0-9]*$/;if(!b.test(c)){info("请输入数字!");return}if(Number(c)%100!=0){info("还款金额为100的倍数!");return}if(Number(c)>Number(a)){info("还款金额不能大于待还金额!");return}if(repayment_pay.repayType=="0"){selectPartRepaymentInfo()}else{getRepaymentInterest()}};function getRepaymentInterest(){var b=$("#hk_money").val();var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","calculateInputMoneyInterest");a.setStringValue("strVersionType","1");a.setStringValue("applyId",repayment_pay.lId);a.setStringValue("repayAmount",b+"");a.setStringValue("customerId",repayment_pay.customerId);a.setStringValue("userName",repayment_pay.userName);raiseTrans(a,"callBackForCalculateInputMoneyInterest")}function callBackForCalculateInputMoneyInterest(e,f,b){if(b==undefined||b==null){_shade_layer.hide();info("请求失败!");return false}if(b.nCode==0){var a=f.getCDOValue("repaymentInfo");var d=a.getStringValue("CODE");if(d=="000"){var h=a.getStringValue("repayAmount");var g=a.getStringValue("interest");var c="还款金额:"+h+"元<br/>支付利息:"+g+"元";$("#payInfo").html(c);_TTPopups.open1({title:"您是否要立即还款？",contentId:"payInfo",cancelBtn:"否",submitBtn:"是",closeCallBack:"doRepayment"})}else{info(a.getStringValue("MSG"))}}}function selectPartRepaymentInfo(){var b=$("#hk_money").val();var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","selectPartRepaymentInfo");a.setStringValue("applyId",repayment_pay.lId);a.setStringValue("repayAmount",b+"");a.setStringValue("customerId",repayment_pay.customerId);a.setStringValue("userName",repayment_pay.userName);a.setStringValue("agreedRepaymentDate",repayment_pay.repayDate);a.setStringValue("preAmount",repayment_pay.preAmount+"");a.setStringValue("totalAmount",repayment_pay.totalAmount+"");raiseTrans(a,"callBackForSelectPartRepaymentInfo")}function callBackForSelectPartRepaymentInfo(a,d,f){if(f==undefined||f==null){_shade_layer.hide();info("请求失败!");return false}if(f.nCode==0){var c=d.getCDOValue("payResult");var b=c.getStringValue("CODE");if(b=="000"){var g=c.getStringValue("repayAmount");var h=c.getStringValue("interest");var i=c.getStringValue("breachMoney");repayment_pay.interest=h;repayment_pay.breachMoney=i;repayment_pay.repayAmount=g;var e="还款金额:"+g+"元<br/>支付利息:"+h+"元<br/>违约金额:"+i;$("#payInfo").html(e);_TTPopups.open1({title:"您是否要立即还款？",contentId:"payInfo",cancelBtn:"否",submitBtn:"是",closeCallBack:"doRepaymentPart"})}else{info(c.getStringValue("MSG"))}}}var doRepayment=function(a){var c=$("#hk_money").val();if(a=="0"){return false}else{var b=new CDO();b.setStringValue("strServiceName","CommonService");b.setStringValue("strTransName","commitRepayment");b.setStringValue("applyId",repayment_pay.lId);b.setStringValue("repayAmount",c+"");b.setStringValue("customerId",repayment_pay.customerId);b.setStringValue("userName",repayment_pay.userName);raiseTrans(b,"callBackForCommitRepayment")}};function callBackForCommitRepayment(d,f,a){_shade_layer.show("支付申请提交中,请稍候...");if(a==undefined||a==null){_shade_layer.hide();info("请求失败!");return false}if(a.nCode==0){var c=f.getCDOValue("payResult");var b=c.getStringValue("CODE");var e=c.getStringValue("MSG");if(b=="000"){openWindow("myCenter/myBorrow/repaymentNotice.htm","还款完成","",1,"",1)}else{info(e)}}_shade_layer.hide()}var doRepaymentPart=function(a){if(a=="0"){return false}else{var b=new CDO();b.setStringValue("strServiceName","CommonService");b.setStringValue("strTransName","commitPartRepayment");b.setStringValue("applyId",repayment_pay.lId);b.setStringValue("repayAmount",repayment_pay.repayAmount);b.setStringValue("customerId",repayment_pay.customerId);b.setStringValue("userName",repayment_pay.userName);b.setStringValue("interest",repayment_pay.interest);b.setStringValue("breachMoney",repayment_pay.breachMoney);b.setStringValue("agreedRepaymentDate",repayment_pay.repayDate);raiseTrans(b,"callBackForCommitPartRepayment")}};function callBackForCommitPartRepayment(c,d,a){if(a==undefined||a==null){_shade_layer.hide();info("请求失败!");return false}if(a.nCode==0){var b=d.getCDOValue("payResult");openWindow("myCenter/myBorrow/repaymentNotice.htm","还款完成","",1,"",1)}_shade_layer.hide()};