var nIdentityState=getQueryString("nIdentityState");var img_dkxy_status="1";var photo_bankCard_number=getQueryString("cardNumber");var photo_bankCode=getQueryString("bankCode");var photo_bankName=getStringValue("bankName");var isXinyongCard=0;var isZhichiCard=1;var bankCodeSelect="";jsHeight.bodyheight();$(document).ready(function(){var a=document.getElementById("div_bl");a.onclick=function(){getBankListT()};var b=document.getElementById("photo_ico");b.onclick=function(){getBankListTT()};main(nIdentityState);max_height("support_bankListDiv")});function main(c){if(c==10||c==null){$("#showinfo").html("此验证码发往预留手机号！");$("#strName").removeAttr("readonly").removeClass("z_nameHoujiazise");$("#strIdentity").removeAttr("readonly").removeClass("z_nameHoujiazise");$("#btn").attr("onclick","checkSendVerifyCode(9,1)");$("#btn1").attr("onclick","checkSendVerifyCode(9,2)");$("#btnT").html("确定").attr("onclick","checkIdentityT()").addClass("z_nameAnnuNew").removeClass("z_nameAnnu");$("#div_dkxy_1").show();$("#nbTime").hide();if(photo_bankCard_number!=""&&photo_bankCard_number!=null){$("#strBankcardNo").val(photo_bankCard_number);$("#strBankName").val(photo_bankName);$("#strBankCode").val(photo_bankCode);var b=getStringValue("strName");var d=getStringValue("strIdentity");var a=getStringValue("strReserveMobile");$("#strName").val(b);$("#strIdentity").val(d);$("#strReserveMobile").val(a)}}else{if(c==20){$("#btnT").html("认证中...").removeAttr("onclick").removeClass("z_nameAnnuNew").addClass("z_nameAnzi");if(photo_bankCard_number!=""&&photo_bankCard_number!=null){$("#strBankcardNo").val(photo_bankCard_number);$("#strBankName").val(photo_bankName);$("#strBankCode").val(photo_bankCode)}$("#photo_ico").hide();eventTrigger(1);$("#nbTime").hide();$("#checkCard").hide();$("#bdTishi1").hide();$("#div_dkxy_1").hide();getStrIdentityInfoT("callBackForGetStrIdentityInfo");$("#ylMsg").attr("style","border-bottom:0px;");$("#ylMsg").hide();realTimeDetection()}else{if(c==30){$("#nbTime").hide();$("#photo_ico").show();getStrIdentityInfoT("callBackForGetStrIdentityInfo")}else{if(c==90||c==100){getStrIdentityInfoT("callBackForGetStrIdentityInfo");$("#checkCard").hide();$("#bdTishi1").hide();$("#ylMsg").hide();$("#div_dkxy_1").hide();$("#btnT").html("银行卡变更").attr("onclick","editBankT()").hide();eventTrigger(1);$("#photo_ico").hide()}else{info("认证状态异常，请联系客服");back()}}}}}function checkIdentityT(){var d=getStringValue("lUserId");var e=1;var j=$("#strName").val().replace(/\s/g,"");var g=$("#strIdentity").val().replace(/\s/g,"");$("#strIdentity").attr("strIdentity",g);var i=$("#strBankCode").val();var h=$("#strBankName").val();var c=$("#strBankcardNo").val().replace(/\s/g,"");var k=$("#strReserveMobile").val().replace(/\s/g,"");var f=$("#strVerifyCode").val();if(isXinyongCard==1){info("不支持信用卡!");return false}if(isZhichiCard==0){info("不支持该行的银行卡!");return false}if(!checkSubmitInfo()){return false}if(f==null||f==undefined||f==""){info("请输入验证码");return false}var b=/^\d{4}$/;if(!b.test(f)){info("验证码格式不正确！");return false}var a=new CDO();a.setStringValue("strServiceName","UserService");a.setStringValue("strTransName","checkIdentity");a.setIntegerValue("nIdentityType",e);a.setStringValue("strName",j);a.setStringValue("strIdentity",g);a.setLongValue("lUserId",Number(d));a.setStringValue("strBankCode",i);a.setStringValue("strBankName",h);a.setStringValue("strBankcardNo",trim(c));a.setStringValue("strReserveMobile",k);a.setStringValue("strMobileCode",f);raiseTrans(a,"callBackForCheckIdentityT");eventTrigger(1);$("#btnT").html("确认").removeAttr("onclick").removeClass("z_nameAnnuNew").addClass("z_nameAnnu")}function callBackForCheckIdentityT(b,c,a){if(a==undefined||a==null){info("请求服务器失败");return false}if(a.nCode==0){$("#btnT").html("认证中...").removeClass("z_nameAnnu").addClass("z_nameAnzi");$("#div_tishi1").html("您的实名认证信息已提交，请耐心等候！");$("#shiming_div_tishi").show();$("#div_dkxy_1").hide();setStringValue("strName",$("#strName").val());realTimeDetection()}else{eventTrigger(0);main(10);info(a.strText)}}function getStrIdentityInfoT(b){var c=getStringValue("lUserId");var a=new CDO();a.setStringValue("strServiceName","UserService");a.setStringValue("strTransName","getStrIdentityInfo");a.setLongValue("lUserId",Number(c));raiseTrans(a,b)}function callBackForGetStrIdentityInfo(a,f,l){if(l==undefined||l==null){info("请求服务器失败");return false}if(l.nCode==0){if(f.exists("cdoIdentity")){var m=f.getCDOValue("cdoIdentity");var c=m.getIntegerValue("nVerifyIsReplace");var k=m.getStringValue("strName");var h=m.getStringValue("strIdentity");var b=m.getIntegerValue("nIdentityState");var i=m.getStringValue("strBankName");var j=m.getStringValue("strBankCode");var d=m.getStringValue("strBankcardNo");var o=m.getStringValue("strReserveMobile");var g=m.getStringValue("strIdVerifyRes");var e=m.getStringValue("dtIdVerifyEndTime");var n=m.getStringValue("strProtocolCode");$("#strName").val(k);$("#strBankName").val(i);$("#strBankCode").val(j);$("#strBankcardNo").val(d);$("#strReserveMobile").val(o);$("#dtIdVerifyEndTime").val(e);$("#strMobile").val(o);if(b==90||b==100||b==20){$("#strIdentity").attr("strIdentity",h);if(h!=null&&h!=""&&h.length==18){h=h.substring(0,4)+"********"+h.substring(14,18)}$("#strIdentity").val(h);return}$("#strIdentity").val(h).attr("strIdentity",h);$("#div_tishi1").html(g);if(photo_bankCard_number!=""&&photo_bankCard_number!=null){$("#strBankcardNo").val(photo_bankCard_number);$("#strBankName").val(photo_bankName);$("#strBankCode").val(photo_bankCode);var k=getStringValue("strName");var h=getStringValue("strIdentity");var o=getStringValue("strReserveMobile");$("#strName").val(k);$("#strIdentity").val(h);$("#strReserveMobile").val(o)}$("#shiming_div_tishi").show();errorView(c)}else{info(l.getText())}}else{info(l.getText())}}function getBankListT(){if($.trim($("#bankListDiv").html()).length>10){$("#mainBody").hide();$("#container_bankList").show();setControlAndroidBack(2);return false}_shade_layer.show("加载中......");var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","getBankCodeName");raiseTrans(a,"callBackForGetBankCodeName")}function callBackForGetBankCodeName(e,g,b){if(b==undefined||b==null){info("请求失败!");_shade_layer.hide();return}if(b.nCode==0){if(g.exists("bankList")){var d=g.getCDOValue("bankList");var f="";for(var c=0;c<d.length;c++){var a="../../img/banklogo/logo"+d[c].getStringValue("strCode")+".png";f+='<div class="z_bankBor" onclick="selectBank('+d[c].getStringValue("strCode")+",'"+d[c].getStringValue("strCnAbbr")+"')\">";f+='<div class="z_bankLogo" style="padding-top:2%;"><img src="'+a+'" /></div>';f+='<div class="z_bankZi font-size4">'+d[c].getStringValue("strCnAbbr")+"</div>";f+="</div>"}$("#bankListDiv").html(f);$("#mainBody").hide();$("#container_bankList").show();setControlAndroidBack(2)}else{info("服务器响应失败")}}else{info("请求失败："+b.strText)}_shade_layer.hide()}function selectBank(b,a){if(a.length>0){$("#strBankName").val(a);$("#strBankCode").val(b)}$("#container_bankList").hide();$("#support_bankList").hide();$("#mainBody").show();setControlAndroidBack(1)}function getProtocolT(){openWindow("model/xieyi_dafy_dk.htm","代扣协议","dkTag=5&bankSource=5",0,"")}function editBankT(){$("#ylMsg").attr("style","border-bottom:0px;");$("#strName").addClass("z_nameHoujiazise");$("#strIdentity").addClass("z_nameHoujiazise");$("#dtIdVerifyEndTime").addClass("z_nameHoujiazise");$("#nbTime").hide();$("#div_dkxy_1").hide();eventTrigger(0);$("#checkCard").show();$("#nbTime").css("border-bottom","0px");$("#btn").attr("onclick","checkSendVerifyCode(8,1)");$("#btn1").attr("onclick","checkSendVerifyCode(8,2)");$("#btnT").html("变更").attr("onclick","replaceBankcard()")}function eventTrigger(a){if(a==0){$("#strBankName").removeClass("z_nameHoujiazise");$("#bank_arrow").show();$("#strBankcardNo").removeAttr("readonly").removeClass("z_nameHoujiazise");$("#strReserveMobile").removeAttr("readonly").removeClass("z_nameHoujiazise");$("#btn").removeAttr("readonly").removeClass("z_nameHoujiazise");$("#strVerifyCode").removeAttr("readonly").removeAttr("style");document.getElementById("div_bl").onclick=function(){getBankListT()}}else{if(a==1){$("#strName").attr("readonly","readonly").addClass("z_nameHoujiazise");$("#strIdentity").attr("readonly","readonly").addClass("z_nameHoujiazise");$("#strBankName").attr("readonly","readonly").addClass("z_nameHoujiazise");$("#strBankCode").attr("readonly","readonly").addClass("z_nameHoujiazise");$("#strBankcardNo").attr("readonly","readonly").addClass("z_nameHoujiazise");$("#strReserveMobile").attr("readonly","readonly").addClass("z_nameHoujiazise");$("#dtIdVerifyEndTime").attr("readonly","readonly").addClass("z_nameHoujiazise");$("#btn").removeAttr("onclick");$("#strVerifyCode").attr("readonly","readonly").attr("style","color:#bbb;");$("#bank_arrow").hide();document.getElementById("div_bl").onclick=function(){};document.getElementById("btn").onclick=function(){}}}}function errorView(a){if(a==0){eventTrigger(0);$("#showinfo").html("此验证码发往预留手机号！");$("#btnT").html("确定").attr("onclick","checkIdentityT()").addClass("z_nameAnnuNew").removeClass("z_nameAnzi");$("#btn").attr("onclick","checkSendVerifyCode(9,1)");$("#btn1").attr("onclick","checkSendVerifyCode(9,2)");$("#strName").removeAttr("readonly").removeClass("z_nameHoujiazise");$("#strIdentity").removeAttr("readonly").removeClass("z_nameHoujiazise")}else{if(a==1){$("#btnT").html("变更").attr("onclick","replaceBankcard()").addClass("z_nameAnnuNew").removeClass("z_nameAnzi");eventTrigger(1);document.getElementById("div_bl").onclick=function(){getBankListT()};$("#strBankName").removeClass("z_nameHoujiazise");$("#strBankcardNo").removeAttr("readonly").removeClass("z_nameHoujiazise");$("#strReserveMobile").removeAttr("readonly").removeClass("z_nameHoujiazise");$("#strVerifyCode").removeAttr("readonly").removeAttr("style").show();$("#bank_arrow").show();$("#btn").attr("onclick","checkSendVerifyCode(8,1)");$("#btn1").attr("onclick","checkSendVerifyCode(8,2)")}else{return false}}$("#checkCard").show();$("#div_dkxy_1").show()}function selectDKXY(){if(img_dkxy_status=="1"){$("#img_dkxy").attr("src","../../img/public/dx_01.png");img_dkxy_status="2"}else{$("#img_dkxy").attr("src","../../img/public/dx_02.png");img_dkxy_status="1"}}function checkSubmitInfo(){var h=getStringValue("lUserId");var b=1;var c=$("#strName").val().replace(/\s/g,"");var f=$("#strIdentity").attr("strIdentity");var g=$("#strBankCode").val();var e=$("#strBankName").val();g=trim(g);e=trim(e);var d=$("#strBankcardNo").val().replace(/\s/g,"");var a=$("#strReserveMobile").val().replace(/\s/g,"");if(c==null||c==undefined||c==""){info("用户真实姓名不能为空");return false}if(f==null||f==undefined||f==""){info("身份证件号不能为空");return false}if(!checkCardId(f)){return false}if(e==null||e==undefined||e==""){info("请选择银行");return false}if(g==null||g==undefined||g==""){info("不支持该行的银行卡!");return false}if(d==null||d==undefined||d==""){info("银行卡号不能为空");return false}if(a==null||a==undefined||a==""){info("银行预留手机号不能为空");return false}if(!checkSubmitMobil(a)){return false}if(img_dkxy_status!="1"){info("请同意签署代扣协议");return false}return true}var countVoiceSMS=0;var countVerifyCode=0;var countdown=60;function checkSendVerifyCode(c,b){var a=$("#strReserveMobile").val().replace(/\s/g,"");if(a==null||a==undefined||a==""){info("银行预留手机号不能为空");return false}if(!checkSubmitMobil(a)){return false}$("#strMobile").val(a);if(b==1){if(countVerifyCode==3){info("您的操作过于频繁!");return false}if(sendVerifyCode(c,2,"btn")){countVerifyCode++}}else{if(b==2){if(countVoiceSMS==3){info("您的操作过于频繁!");return false}if(sendVerifyCode(c,1,"btn")){$("#bdTishi1").hide();$("#bdTishi2").show();countVoiceSMS++}}}}var rzStateCount=1;var rzIntervalCount=10;function realTimeDetection(){if(rzStateCount%rzIntervalCount==0){rzStateCount++;var b=getStringValue("lUserId");var a=new CDO();a.setStringValue("strServiceName","UserService");a.setStringValue("strTransName","queryIdentity");a.setLongValue("lUserId",Number(b));raiseTrans(a,"callBackForIsCardRealTime")}else{setTimeout(function(){rzStateCount++;realTimeDetection()},1000)}}function callBackForIsCardRealTime(f,g,b){if(b==undefined||b==null){info("请求服务器失败");rzStateCount=1;realTimeDetection();return false}if(b.nCode==0){if(g.exists("nIdentityState")){var c=g.getIntegerValue("nIdentityState");if(c==90||c==100){$("#div_tishi1").html("认证成功！");$("#shiming_div_tishi").show();$("#ylMsg").hide();$("#checkCard").hide();$("#div_dkxy_1").hide();$("#btnT").html("认证成功！").removeClass("z_nameAnnu").addClass("z_nameAnzi")}else{if(c==10){}else{if(c==20){rzStateCount=1;realTimeDetection()}else{if(c==30){var e=$("#strIdentity").attr("strIdentity");$("#strIdentity").val(e);$("#div_dkxy_1").show();var h=g.getStringValue("strIdVerifyRes");$("#div_tishi1").html(h);$("#shiming_div_tishi").show();$("#photo_ico").show();if(g.exists("cdoState")){var d=g.getCDOValue("cdoState");var a=d.getIntegerValue("nVerifyIsReplace");errorView(a)}}}}}}}else{info("请求失败："+b.strText);rzStateCount=1;realTimeDetection()}}var wlback=1;var isRefresh=getQueryString("isRefresh");isRefBack(2);function isRefBack(b){if(wlback==1){var a=getQueryString("isRefresh");if(b==1){if(a==1){openWindow("myCenter/securityCenter/accountCenter.htm","安全中心","",1,"",1)}else{if(a==2){openDelayWindow("index.htm","首页","",1,"",1)}else{back()}}}else{if(a==1){setBackURL("myCenter/securityCenter/accountCenter.htm","安全中心","",1,"")}else{if(a==2){setBackURL("index.htm","首页","",1,"")}else{}}}}else{var a=getQueryString("isRefresh");if(a==1){setBackURL("myCenter/securityCenter/accountCenter.htm","安全中心","",1,"")}else{if(a==2){setBackURL("index.htm","首页","",1,"")}else{}}}}function replaceBankcard(){var h=getStringValue("lUserId");var f=$("#strBankCode").val();var d=$("#strBankName").val();var c=$("#strBankcardNo").val().replace(/\s/g,"");var a=$("#strReserveMobile").val().replace(/\s/g,"");var b=$("#strVerifyCode").val();if(!checkSubmitInfo()){return false}if(b==null||b==undefined||b==""){info("请输入验证码");return false}var g=/^\d{4}$/;if(!g.test(b)){info("验证码格式不正确！");return false}var e=new CDO();e.setStringValue("strServiceName","UserService");e.setStringValue("strTransName","replaceBankcard");e.setLongValue("lUserId",Number(h));e.setStringValue("strBankCode",f);e.setStringValue("strBankName",d);e.setStringValue("strBankcardNo",trim(c));e.setStringValue("strReserveMobile",a);e.setStringValue("strMobileCode",b);raiseTrans(e,"callBackForReplaceBankcard");eventTrigger(1);$("#btnT").html("确认").removeAttr("onclick").removeClass("z_nameAnnuNew").addClass("z_nameAnnu")}function callBackForReplaceBankcard(b,c,a){if(a==undefined||a==null){info("请求服务器失败");return false}if(a.nCode==0){$("#div_tishi1").html("您的银行卡变更信息已提交，请耐心等候！");$("#shiming_div_tishi").show();eventTrigger(1);$("#btnT").html("变更中...").removeClass("z_nameAnnu").addClass("z_nameAnzi");realTimeDetection()}else{info(a.strText);$("#btnT").addClass("z_nameAnnuNew");editBankT()}}function getBankListTT(){if($.trim($("#support_bankListDiv").html()).length>10){$("#mainBody").hide();$("#container_bankList").hide();$("#support_bankList").show();setControlAndroidBack(2);return false}setStringValue("strName",$("#strName").val());setStringValue("strIdentity",$("#strIdentity").val()+"");setStringValue("strReserveMobile",$("#strReserveMobile").val());_shade_layer.show("加载中......");var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","getBankCodeName");raiseTrans(a,"callBackForGetBankCodeName2")}function callBackForGetBankCodeName2(f,h,b){if(b==undefined||b==null){info("请求失败!");_shade_layer.hide();return}if(b.nCode==0){if(h.exists("bankList")){var d=h.getCDOValue("bankList");var g="";for(var c=0;c<d.length;c++){var e=d[c].getStringValue("strCode");bankCodeSelect+=mappingBank.getConstant(e)+",";var a="../../img/banklogo/logo"+d[c].getStringValue("strCode")+".png";g+='<div class="z_bankBor" >';g+='<div class="z_bankLogo" style="padding-top:2%;"><img src="'+a+'" /></div>';g+='<div class="z_bankZi font-size4">'+d[c].getStringValue("strCnAbbr")+"</div>";g+="</div>"}$("#support_bankListDiv").html(g);$("#mainBody").hide();$("#support_bankList").show();setControlAndroidBack(2)}else{info("服务器响应失败")}}else{info("请求失败："+b.strText)}_shade_layer.hide()}var openCamera=function(){setStringValue("bankCodeSelect",bankCodeSelect);EngineClass.openScanningBankcardPhoto("callBackScanningBankcardPhoto",bankCodeSelect)};var callBackScanningBankcardPhoto=function(c,b,d,a,e,g){if(nIdentityState==10||nIdentityState==null){setStringValue("strName",$("#strName").val());setStringValue("strIdentity",$("#strIdentity").val());setStringValue("strReserveMobile",$("#strReserveMobile").val())}setStringValue("bankCode",c);setStringValue("bankName",b);setStringValue("cardNumber",d);setStringValue("cardType",a);setStringValue("cradName",e);var f="photoUrl="+g+"&nIdentityState="+nIdentityState;openWindow("myCenter/securityCenter/scanningBankcard.htm","获取到的卡号",f,0)};var inputBankCard=function(a){var b=new String(a.value);if(b.length>14){EngineClass.checkBankcard("callBackCheckBankcard",trim(a.value))}};var callBackCheckBankcard=function(d,c,a,e){if(a.indexOf("信用卡")>=0||a.indexOf("贷记卡")>=0){info("不支持信用卡！");$("#strBankName").val(c);isXinyongCard=1;return}else{isXinyongCard=0}d=d.toString().substring(1,4);d=bankMapping.getConstant(d);var b=getStringValue("bankCodeSelect");if((d==""||d==undefined)&&b.indexOf(d)<0){info("不支持该行的银行卡!");$("#strBankName").val(c);isZhichiCard=0;isXinyongCard=0;return}else{isZhichiCard=1}$("#strBankCode").val(d);$("#strBankName").val(c)};var stagespopup=function(){javascript:scrollTo(0,0);setTimeout(function(){document.ontouchmove=function(a){a.preventDefault()};document.getElementById("fin_i_table_list").style.display="block";document.getElementById("black_stages_overlayasd").style.display="block"},300)};var stages_close=function(){document.ontouchmove=function(a){};document.getElementById("fin_i_table_list").style.display="none";document.getElementById("black_stages_overlayasd").style.display="none"};var max_height=function(c){var a,b;if(window.innerHeight){a=window.innerHeight}else{if((document.body)&&(document.body.clientHeight)){a=document.body.clientHeight}}b=a*0.7+"px";document.getElementById(c).style.maxHeight=b};ios_ction();