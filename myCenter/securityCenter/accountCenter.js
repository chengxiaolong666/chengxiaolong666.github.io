var nIsOpenGesturePassword=1;var strGesturePassword="";var ss_pwd=document.getElementById("ss_pws");var sms=0;var dks=0;var scs=0;var strProtocolCode="";var strProtocolDate="";var strProtocolURL="";var aqStateCount=1;var aqIntervalCount=10;jsHeight.bodyheight();ss_pwd.onclick=function(){var b=EngineClass.getStringValue("lUserId");b=new Number(b);if(ss_pwd.className=="z_pws_tap"){var a=new Array();a=EngineClass.getArrayValue("gesturePasswordArray"+b);if(a==null||a=="null"||a.length!=2||a==undefined||a=="undefined"){info("您未设置手势密码");return}else{b=String(b);EngineClass.verifyGesturePasswordClose(a[0],b)}}else{ss_pwd.className="z_pws_tap";ss_pwd.childNodes[1].className="z_rightrid";nIsOpenGesturePassword=1;var a=["",nIsOpenGesturePassword];a=EngineClass.getArrayValue("gesturePasswordArray"+b);a[1]=nIsOpenGesturePassword;EngineClass.setArrayValue("gesturePasswordArray"+b,a)}};$(document).ready(function(){setBackURL("myCenter/myIndex.htm","我的","",1,"");var c=getStringValue("lUserId");c=new Number(c);var a=EngineClass.getArrayValue("gesturePasswordArray"+c);nIsOpenGesturePassword=a[1];if(a==null||a=="null"||a.length!=2||a==undefined||a=="undefined"){nIsOpenGesturePassword=a[1]}if(nIsOpenGesturePassword==1){ss_pwd.className="z_ssPws";ss_pwd.childNodes[1].className="z_rightrid"}else{ss_pwd.className="z_ssCcpws";ss_pwd.childNodes[1].className="z_leftrid"}var b=new CDO();b.setStringValue("strServiceName","UserService");b.setStringValue("strTransName","queryIdentity");b.setLongValue("lUserId",Number(c));EngineClass.raiseTrans(b,"callBackGetCardStatus")});function callBackGetCardStatus(e,g,a){if(a==undefined||a==null){info("请求服务器失败");return false}if(a.nCode==0){if(g.exists("nIdentityState")){var c=g.getIntegerValue("nIdentityState");sms=c;if(c==90||c==100){$("#cardStatus").html("已认证");var f=g.getIntegerValue("nProtocolState");shownProtocol(f);if(f==90||f==100){scs=g.getIntegerValue("nProtocolProductionState")}strProtocolCode=g.getStringValue("strProtocolCode");var d=g.getCDOValue("cdoState");var b=d.getStringValue("strName");setStringValue("strName",b)}else{if(c==10){$("#cardStatus").html("未认证");shownProtocol(10);setStringValue("strName","")}else{if(c==20){$("#cardStatus").html("认证中");shownProtocol(10);setStringValue("strName","")}else{if(c==30){$("#cardStatus").html("认证失败");shownProtocol(10);setStringValue("strName","")}}}}}}else{info("请求失败："+a.strText)}setTimeout(function(){realTimeDetectionByAq()},15)}function shownProtocol(a){dks=a;if(a==90||a==100){$("#protocolStatus").html("已签订")}else{if(a==10||a==30){$("#protocolStatus").html("未签订")}else{if(a==20){$("#protocolStatus").html("签订中")}}}}function isIdProtocol(){if(sms!=90&&sms!=100){info("您未实名认证成功，签订代扣协议需要实名认证！");return false}if(dks==90||dks==100){if(scs==2||scs==14){_shade_layer.show("加载中......");callProtocol(2,strProtocolCode,"myCenter/securityCenter/accountCenter.htm")}else{if(scs==0||scs==3){info("代扣协议未生成，请你耐心等待！")}else{if(scs==1){info("代扣协议生成中，请你耐心等待！")}}}}if(dks==10||dks==30){openWindow("model/xieyi_dafy_dk.htm","代扣协议","dkTag=4",0,"")}else{if(dks==20){info("代扣协议签订中，请你耐心等待！");return}}}function callBackForGetUserName(e,g,b){if(b==undefined||b==null){info("请求失败!");getLoginIdAscripInfo();return}if(b.nCode==0){if(g.exists("cdoIdentity")){var f=g.getCDOValue("cdoIdentity");var a=f.getIntegerValue("nVerifyIsReplace");var c=f.getIntegerValue("nIdentityState");if(a==1||c==90||c==100){var d="";d=f.getStringValue("strName");setStringValue("strName",d)}}}else{info("请求失败："+b.strText)}}function realTimeDetectionByAq(){if(aqStateCount%aqIntervalCount==0){aqStateCount++;var b=getStringValue("lUserId");var a=new CDO();a.setStringValue("strServiceName","UserService");a.setStringValue("strTransName","queryIdentity");a.setLongValue("lUserId",Number(b));raiseTrans(a,"callBackForIsCardRealTimeByAq")}else{setTimeout(function(){aqStateCount++;realTimeDetectionByAq()},1000)}}function callBackForIsCardRealTimeByAq(e,g,a){if(a==undefined||a==null){info("请求服务器失败");return false}if(a.nCode==0){if(g.exists("nIdentityState")){var c=g.getIntegerValue("nIdentityState");sms=c;if(c==90||c==100){$("#cardStatus").html("已认证");var f=g.getIntegerValue("nProtocolState");shownProtocol(f);if(f==90||f==100){scs=g.getIntegerValue("nProtocolProductionState")}strProtocolCode=g.getStringValue("strProtocolCode");var d=g.getCDOValue("cdoState");var b=d.getStringValue("strName");setStringValue("strName",b);if(dks==20){setTimeout(function(){realTimeDetectionByAq()},15)}else{if(dks==90||dks==100){if(scs==0||scs==1){setTimeout(function(){realTimeDetectionByAq()},15)}}}}else{if(c==10){$("#cardStatus").html("未认证");shownProtocol(10);setStringValue("strName","")}else{if(c==20){$("#cardStatus").html("认证中");shownProtocol(10);setStringValue("strName","");setTimeout(function(){realTimeDetectionByAq()},15)}else{if(c==30){$("#cardStatus").html("认证失败");shownProtocol(10);setStringValue("strName","")}}}}}}else{info("请求失败："+a.strText)}}function updateGesturePassword(){var b=getStringValue("lUserId");b=new Number(b);var a=new Array();a=getArrayValue("gesturePasswordArray"+b);if(a==null||a=="null"||a.length!=2||a==undefined||a=="undefined"){info("您未设置手势密码");return}else{b=String(b);EngineClass.editGesturePassword(a[0],b)}}function isIdCard(){_shade_layer.show("加载中......");var b=getStringValue("lUserId");var a=new CDO();a.setStringValue("strServiceName","UserService");a.setStringValue("strTransName","queryIdentity");a.setLongValue("lUserId",Number(b));EngineClass.raiseTrans(a,"callBackForIsCard")}function callBackForIsCard(c,d,a){if(a==undefined||a==null){EngineClass.info("请求服务器失败");return false}if(a.nCode==0){if(d.exists("nIdentityState")){var b=d.getIntegerValue("nIdentityState");EngineClass.openWindow("myCenter/securityCenter/accountIdCard.htm","实名认证","clearUser=1&isRefresh=1&nIdentityState="+b,1,"")}}else{EngineClass.info(a.strText)}_shade_layer.hide()}function callProtocol(a,b,c){if(a==1){EngineClass.openWindow("model/xieyi_dafy_dk.htm","代扣协议","dkTag="+a+"&openUrl="+c,0)}else{if(a==2){if(b==""||b==null){EngineClass.info("代扣协议生成中请稍候!")}else{EngineClass.seeToAgreementAfterSignature(b)}}else{if(a==3){EngineClass.openWindow("model/xieyi_dafy_dk.htm","代扣协议","dkTag="+a+"&openUrl="+c,0)}}}setTimeout(function(){_shade_layer.hide()},1500)}var flag=true;function isSetPayPassword(b){if(!flag){return}flag=false;var c=getStringValue("lUserId");var a=new CDO();a.setStringValue("strServiceName","CustomerService");a.setStringValue("strTransName","queryIsSetPayPwd");a.setLongValue("lUserId",Number(c));a.setLongValue("val",b);EngineClass.raiseTrans(a,"callBackForIsSetPayPwd")}function callBackForIsSetPayPwd(c,e,b){if(b==undefined||b==null){EngineClass.info("请求失败!");flag=true;return false}if(b.nCode==0){var d=c.getIntegerValue("val");var a=e.getIntegerValue("nIsSetPayPwd");if(d==1&&a==0){var f=getStringValue("lUserId");isAuthentication(f)}else{if(d==1&&a==1){info("您已经设置过支付密码了")}else{if(d==2&&a==0){info("您还未设置过支付密码")}else{if(d==2&&a==1){openWindow("myCenter/securityCenter/payPwdModify.htm","修改支付密码","",1,"")}else{if(d==3&&a==0){info("您还未设置过支付密码")}else{if(d==3&&a==1){openWindow("myCenter/securityCenter/payPwdRetrieve.htm","找回支付密码","",1,"")}}}}}}}else{EngineClass.info(b.getText())}flag=true}function isAuthentication(b){var a=new CDO();a.setStringValue("strServiceName","UserService");a.setStringValue("strTransName","queryIdentity");a.setLongValue("lUserId",Number(b));raiseTrans(a,"callBackQueryIdentity")}function callBackQueryIdentity(c,d,a){if(a==undefined||a==null){info("请求失败!");flag=true;return false}if(a.nCode==0){if(d.exists("nIdentityState")){var b=d.getIntegerValue("nIdentityState");if(b==90||b==100){openWindow("myCenter/securityCenter/payPwdSet.htm","设置支付密码","",1,"")}else{if(b==20){info("实名认证处理中，请等待实名认证成功后设置支付密码")}else{if(b==30){info("实名认证失败，不能设置支付密码，请重新实名认证");setTimeout(function(){openWindow("myCenter/securityCenter/accountIdCard.htm","实名认证","clearUser=1&nIdentityState=30&isRefresh=1",0,"")},1000)}else{info("请先实名认证");setTimeout(function(){openWindow("myCenter/securityCenter/accountIdCard.htm","实名认证","clearUser=1&nIdentityState=10",1,"")},1000)}}}}else{EngineClass.info(a.getText())}}else{EngineClass.info(a.getText())}flag=true};