var lUserId=getStringValue("lUserId");var strLoginId=getStringValue("strLoginId");var backUrl=getStringValue("backUrl");var nFlage=-1;var isCallbackForList=true;var nStart_one=0;var nStart_two=0;var nPageSize=6;var pageCount=0;var strSerlNum_tmp="";jsHeight.bodyheight();$(document).ready(function(){var b=getQueryString("backType");var a="";if(b=="1"){a="myCenter/myIndex.htm"}else{if(b=="0"){a="mall/goodsList.htm"}else{if(b=="2"){a="mall/goodsDetail.htm"}else{if(b=="stages"){a="mall/stages.htm"}else{if(b=="beforePay"){a="mall/beforePay.htm"}else{if(b=="addressList"){a="mall/addressList.htm"}else{a="myCenter/myIndex.htm"}}}}}}if((b!="afterPayment")&&(b!="addressedit")&&(b!="addressAdd")){setBackURL(a,"首页","",1,"",1)}getOrderListByBuyerId(2,0,0)});function reChoose(a,b){if($(b).hasClass("row")){return false}else{$("#orderList").html("");$("#ck_order_e").find("a").each(function(){$(this).removeClass("row")});$(b).addClass("row");_shade_layer.show("加载中,请稍候......");nStart_one=0;nStart_two=0;getOrderListByBuyerId(a,0,0)}}function getOrderListByBuyerId(c,b,a){isCallbackForList=false;nFlage=c;var d=new CDO();d.setStringValue("strServiceName","OrderService");d.setStringValue("strTransName","getOrderListByBuyerId");d.setLongValue("lBuyerId1",getStringValue("lOldCustomerId"));d.setLongValue("lBuyerId2",lUserId);d.setIntegerValue("nStarta",b);d.setIntegerValue("nStartb",a);d.setIntegerValue("nPagesize",nPageSize);d.setIntegerValue("nType",nFlage);raiseTrans(d,"callBackForOrderListByBuyerId")}function callBackForOrderListByBuyerId(c,d,b){if(b==null||b==undefined){info("通信失败!");_shade_layer.hide();return false}if(b.nCode==-90000){info(b.strText);_shade_layer.hide();return false}nStart_one=d.getStringValue("nStart_one");nStart_two=d.getStringValue("nStart_two");if(b.nCode==0&&0==nStart_one&&0==nStart_two){var a="";if(nFlage==2){a="暂无分期订单"}else{if(nFlage==1){a="暂无未完成订单"}else{if(nFlage==0){a="暂无已完成订单"}}}_Not.show("orderList",a,"../../")}else{if(b.nCode==0){addInfo(d,nFlage)}else{info(b.strText)}}isCallbackForList=true;_shade_layer.hide()}function addInfo(f,e){var p=f.getCDOArrayValue("cdoOrderList");for(var g=0;g<p.length;g++){var h=p[g].getStringValue("strGoodsBrandModel");var q=p[g].getStringValue("strGoodsTitle");var c=p[g].getStringValue("nAmount1");var d=p[g].getStringValue("strGoodsLogoURL");var o=p[g].getStringValue("dtCreateTime");var n=p[g].getStringValue("strSerlNum");var b=p[g].getStringValue("nFirstPrice");var m=p[g].getStringValue("lId");var k=p[g].getStringValue("nState");var j=p[g].getStringValue("strSerlNum");var a="";if(k==2){a="处理中"}if(k==0||k==1){a="待支付"}if(k==3||k==4||k==5){a="支付成功"}if(k==-1||k==6||k==11||k==12||k==13){a="订单关闭"}var l="";l="<li><a onclick=\"openDetail('"+j+'\')"> <div class="WListRechDeta"><div class="WBusinessLogo"><div class="WorderDetailsNew"></div><img src="'+d+'"/></div><div class="WapiCzjla clearfix">	<p>'+q+'<br>	<span class="Wspan_money">￥'+c+'</span><br>	<span class="Wspan_red">'+a+"</span>";if(k==3||k==4||k==5){l=l+'<span class="WckApiRightNew"><a><span class="WspanBlue" onclick="openThedetailsList(\''+j+'\')"><img src="../../img/api_book.jpg"/>查看账单</span></a></span>'}if(k==0||k==1){l=l+'<span class="WckApiRight"><a href="javascript:void(0);" onclick="doPay(\''+n+"','"+o+"','"+m+"','"+b+'\');"><span class="WspanBlueAclo">继续支付</span></a></span>'}if(k==0){l=l+'<span class="WckApiRight"><a href="javascript:void(0);" onclick="doClose(\''+j+'\');"><span class="WspanBlueAclo">取消订单</span></a></span>'}l=l+"	</p></div></div></a></li>";$("#orderList").append(l)}}function openDetail(b){var a="strSerlNum="+b;openWindow("myCenter/mallOrder/orderDetails.htm","订单详情",a,0)}function openThedetailsList(b){var a="strSerlNum="+b;openWindow("myCenter/mallOrder/thedetailsList.htm","账单列表",a,0)}var isDoingPay=false;var strOrderSerl="";var strOrderTime="";var lOrderId="";var strFirstPrice="";function doPay(b,a,d,c){strOrderSerl=b;strOrderTime=a;lOrderId=d;strFirstPrice=c;checkIsPayPwd("readyOpenPayWindow")}function readyOpenPayWindow(){openPayWindow("请输入支付密码","交易金额："+(Number(strFirstPrice)/100)+" 元","","",true,"callBackForIntoPass")}function callBackForIntoPass(b,a){if(a==0){isDoingPay=false}else{payOrder(b)}}function payOrder(a){var b=new CDO();b.setStringValue("strServiceName","OrderService");b.setStringValue("strTransName","updateOrderStateByOrderIdAndState");b.setLongValue("lOrderId",lOrderId);b.setLongValue("lBuyerId",""+lUserId);b.setStringValue("strOrderSerl",""+strOrderSerl);b.setStringValue("strOrderTime",""+strOrderTime);b.setStringValue("strPayPassword",""+a);raiseTrans(b,"callBackForPO")}function callBackForPO(e,f,b){isDoingPay=false;var d=e.getStringValue("strOrderSerl");var c=e.getStringValue("strOrderTime");var a="strResult=";if(b==undefined||b==null){a=a+"支付失败！&"}else{if(b.nCode!=0){if(b.nCode==-50){isDisposeing=0;payPwdPutError(b.strText);return false}else{info(b.strText);setTimeout(function(){openWindow("myCenter/mallOrder/orderList.htm","我的订单","",0)},1000);return false}}else{a=a+"&"}}openWindow("mall/afterPayment.htm","支付结果",a+"strOrderSerl="+d+"&strFirstPrice="+strFirstPrice+"&strOrderTime="+c,1)}function doClose(a){strSerlNum_tmp=a;_TTPopups.open2({content:"您确定要取消当前订单吗",cancelBtn:"取消",submitBtn:"确定",closeCallBack:"cancelOrder"})}function cancelOrder(b){if(b==1){var a=new CDO();a.setStringValue("strServiceName","OrderService");a.setStringValue("strTransName","changeOrderStateByBeforeCond");a.setStringValue("strSerlNum",strSerlNum_tmp);a.setIntegerValue("nStateAfter",-1);a.setIntegerValue("nStateBefore",0);raiseTrans(a,"callBackForCO")}}function callBackForCO(b,c,a){strSerlNum_tmp="";if(a==null||a==undefined){info("通信失败!");return false}if(a.nCode==0){info("取消成功！");openWindow("myCenter/mallOrder/orderList.htm","订单列表","",1);return false}else{info("取消失败，"+a.strText);return false}}$(document).scroll(function(){var b=$(this).scrollTop();var a=$(document).height();var c=$(this).height();if(b+c>=a){if(isCallbackForList){getOrderListByBuyerId(nFlage,nStart_one,nStart_two)}}});