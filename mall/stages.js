var _obj={};_obj.nMaxBuyCount=1;_obj.detailArr=[];_obj.Price=0;_obj.lGoodsSKUId=0;_obj.firstMoney=0;_obj.monthMoney=0;_obj.buyNum=0;_obj.title="";_obj.periodsNum=0;_obj.logoURL="";_obj.load=function(){_obj.lGoodsId=getStringValue("lGoodsId");if(!_obj.lGoodsId){info("系统错误");return}var b=_obj.pageIndex*_obj.pageSize;var a=new CDO();a.setStringValue("strServiceName","GoodsService");a.setStringValue("strTransName","getGoodsDetailsByGoodsId");a.setLongValue("lGoodsId",Number(_obj.lGoodsId));raiseTrans(a,"callBackGeneratePage")};function callBackGeneratePage(b,c,a){if(a==null||typeof a=="undefined"){info("请求失败");return}if(a.nCode==0&&c.exists("cdoDefaultGoods")){_obj.initLoad(c)}else{info("请求失败："+a.strText)}}_obj.initLoad=function(C){var d=C.getCDOValue("cdoDefaultGoods");var e=d.getStringValue("strTitle");var o=d.getStringValue("nPrice");var A=d.getStringValue("strLogoURL");var s=d.getStringValue("strTermCountList");var a=d.getStringValue("strFirstPriceList");var D=d.getStringValue("strAgreementUrl");var f=d.getStringValue("nMaxBuyCount");var B=d.getStringValue("lGoodsSKUId");var g=document.getElementById("title_id");_obj.innerHTML(g,e);_obj.title=e;var h=document.getElementById("logoURL_id");h.src=A;_obj.logoURL=A;var q=new CDO();q.setStringValue("strServiceName","agreementService");q.setStringValue("strTransName","getAgreement");raiseTrans(q,"callBackAgreementPage");var b=C.getCDOValue("cdoGoodsSKUInfo");_obj.generateTypeHTML(d,b);var u=C.getCDOArrayValue("cdoGoodDetailsList");for(var w=0;w<u.length;w++){var j=u[w];var i=j.getStringValue("strSKUItem0Value");var z=j.getStringValue("strSKUItem1Value");var p=j.getStringValue("strSKUItem2Value");var c=j.getStringValue("strSKUItem3Value");var v=j.getStringValue("strSKUItem4Value");var x=j.getStringValue("lGoodsSKUId");var t=j.getStringValue("strTermCountList");var l=j.getStringValue("strFirstPriceList");var r=j.getStringValue("nMaxBuyCount");var y=j.getStringValue("nPrice");var n=j.getStringValue("nCount");var m={text:i+"|"+z+"|"+p+"|"+c+"|"+v,hashCode:_obj.hashCode(i+z+p+c+v),nMaxBuyCount:r,strTermCountList:t,strFirstPriceList:l,lGoodsSKUId:x,nPrice:y,nCount:n};_obj.detailArr.push(m)}_obj.setVal(a,s,f,B,o);_obj.show("contentId",true);_shade_layer.hide()};function callBackAgreementPage(c,a,d){if(d.nCode==0&&a.exists("strAgreement")){var b=document.getElementById("content_id");b.innerHTML="";b.innerHTML=a.getStringValue("strAgreement")}}_obj.setVal=function(u,e,t,v,i){if(u.length<=0||e.length<=0){return}var s=document.getElementById("price_id");_obj.innerHTML(s,"￥"+(Number(i)/100).toFixed(2));_obj.Price=i;var p=u.split("|");var r=e.split("|");var h=p[0];var d=r[0];var b=document.getElementById("sel_money_id");var k=document.getElementById("sel_classify_id");var f="";var c="";for(var q=0;q<p.length;q++){var j=(Number(p[q])/100).toFixed(2);if(q==0){f+='<span class="span-border span_border_row" val='+p[q]+' chooice="1" onclick="_obj.changeEvent(this)">'+j+"</span>"}else{f+='<span class="span-border" val='+p[q]+' chooice="0" onclick="_obj.changeEvent(this)">'+j+"</span>"}}_obj.html("sel_money_id",f);for(var o=0;o<r.length;o++){if(o==0){c+='<span class="span-border span_border_row" chooice="1" onclick="_obj.changeEvent(this)">'+r[o]+"</span>"}else{c+='<span class="span-border" chooice="0" onclick="_obj.changeEvent(this)">'+r[o]+"</span>"}}_obj.html("sel_classify_id",c);_obj.nMaxBuyCount=t;_obj.lGoodsSKUId=v;_obj.firstMoney=h;_obj.periodsNum=d;var g=(((_obj.Price-h)/d)/100).toFixed(2);_obj.monthMoney=g;var a=document.getElementById("num_id");var l=Number(a.innerHTML);if(l>_obj.nMaxBuyCount){a.innerHTML="";a.innerHTML=1;l=1}if(_obj.nMaxBuyCount==0){l==0}_obj.setDynamicVal(l)};_obj.setDynamicVal=function(g){var h=_obj.firstMoney;var e=_obj.periodsNum;var c=((Number(h)/100)*g).toFixed(2);var b=document.getElementById("first_id");var f=document.getElementById("periods_id");_obj.innerHTML(b,"￥"+c);_obj.innerHTML(f,e+"个月");var d=document.getElementById("tips_id");var i=((_obj.Price-h)/e)/100;i=(i*g).toFixed(2);var a="<li>首付："+c+'元</li><li style="padding-left:2%;">分期：'+e+'个月</li><li style="padding-left:2%;">每月支付：'+i+"元</li>";_obj.innerHTML(d,a)};_obj.generateTypeHTML=function(b,c){var q=["sku0","sku1","sku2","sku3","sku4"];var o=["strSKUItem0Value","strSKUItem1Value","strSKUItem2Value","strSKUItem3Value","strSKUItem4Value"];var e=document.getElementById("type_id");for(var g=0;g<q.length;g++){var r=b.getStringValue(o[g]);var n=c.getStringValue(q[g]);if(!r||!n){return}var m=n.split(":");var l=m[1].split("|");var k="";for(var f=0;f<l.length;f++){var a=0;var j="span-border";if(r==l[f]){a="1";j="span-border span_border_row"}var p="<span class='"+j+"' choose='"+a+"' onclick='_obj.choiceEvent(this)'>"+l[f]+"</span>";k+=p}var d=document.createElement("div");d.className="list_staging_ART";d.setAttribute("index",g);d.innerHTML="<h3>"+m[0]+"</h3><div class='staging_Option'>"+k+"</div>";e.appendChild(d)}};_obj.choiceEvent=function(e){var h=e.getAttribute("isExec");if(h&&h=="0"){return}var b=e.getAttribute("choose");if(b==1){return}$(e).removeClass().addClass("span-border span_border_row");$(e).siblings("span:not(.span_opacity4)").removeClass().addClass("span-border");$(e).attr("choose","1");$(e).siblings("span").attr("choose","0");var c="";$("#type_id").find("span[choose='1']").each(function(j,k){c+=k.innerHTML});var g=_obj.hashCode(c);for(var i=0;i<_obj.detailArr.length;i++){var f=_obj.detailArr[i];if(g==f.hashCode){_obj.setVal(f.strFirstPriceList,f.strTermCountList,f.nMaxBuyCount,f.lGoodsSKUId,f.nPrice)}}var d=e.innerHTML;var a=$(e).parent("div").parent("div").attr("index");$(e).parent("div").parent("div").siblings("div").each(function(j,l){var k=l.getAttribute("index");$(l).find("span").each(function(p,u){var m=u.innerHTML;var n=false;for(var t=0;t<_obj.detailArr.length;t++){var s=_obj.detailArr[t];var q=s.text;var r=q.split("|");if(r[k]==m&&r[a]==d){n=true;break}}if(n==false){u.className="";u.className="span-border span_opacity4";u.setAttribute("isExec","0")}else{var o=u.className;if(o.indexOf("span_border_row")==-1){u.className="span-border";u.setAttribute("choose","0")}u.setAttribute("isExec","1")}})})};_obj.numBtn=function(d,a){if(_obj.nMaxBuyCount==1){info("最大数量为1");return}var b=document.getElementById(d);var c=Number(b.innerHTML);c=a==true?c+1:c-1;if(c<=1){c=1}if(c>_obj.nMaxBuyCount){c=_obj.nMaxBuyCount}_obj.setDynamicVal(c);b.innerHTML=c;_obj.buyNum=c};_obj.btnCancel=function(a){$("#agreement_id").css("display","none");$("#app_screen").css("display","none");cancelZZ();_obj.setCheckBox(a)};_obj.setCheckBox=function(a){var f=document.getElementById("staging_fq");var c=f.firstChild;var b=f.getAttribute("choice");var e=false;e=b=="1"?false:true;if(a){e=a=="0"?false:true}var d=e==true?"../img/public/dx_02.png":"../img/public/dx_01.png";c.src=d;f.setAttribute("choice",e==true?"1":"0")};_obj.hashCode=function(e){var c=0,d=0;var a=e.length;for(var b=0;b<a;b++){c=31*c+e.charCodeAt(d++);if(c>2147483647||c<2147483648){c=c&4294967295}}return c};_obj.changeEvent=function(b){var a=b.getAttribute("chooice");if(a==1){return}if(b.parentNode.id=="sel_money_id"){_obj.setSpan(b);_obj.firstMoney=b.getAttribute("val")}else{_obj.setSpan(b);_obj.periodsNum=b.innerHTML}var c=document.getElementById("num_id");_obj.setDynamicVal(Number(c.innerHTML))};_obj.setSpan=function(c){var b=c.parentNode.getElementsByTagName("span");for(var a=0;a<b.length;a++){b[a].className="span-border";b[a].setAttribute("chooice","0")}c.className="span-border span_border_row";c.setAttribute("chooice","1")};_obj.submit=function(){var c=(Number(_obj.Price)/100).toFixed(2);var f=getStringValue("lUserId");if(f==null){info("用户未登录，请登录后在访问！");return false}var e=document.getElementById("staging_fq");var d=e.firstChild;var b=e.getAttribute("choice");if(b=="0"){info("请同意协议后再提交");return false}var a=true;$("#type_id").find("h3").each(function(g,h){(function(k){var i=k.innerHTML;var j=$(k).parent().find("span[class$='span_border_row']").length;if(j==0){a=false;info("请选择"+i);return}})(h)});if(a==false){return}_obj.goToPay()};_obj.goToPay=function(){setStringValue("strGoodsTitle",_obj.title);setStringValue("strGoodsAmount",$("#num_id").html());setStringValue("strAmount",_obj.Price+"");setStringValue("strFirstPrice",_obj.firstMoney+"");setStringValue("strTermCount",_obj.periodsNum+"");setStringValue("strGoodsId",_obj.lGoodsId+"");setStringValue("strGoodsSKUId",_obj.lGoodsSKUId+"");setStringValue("strTermPrice",Number(_obj.monthMoney)*100+"");setStringValue("strGoodsURL",_obj.logoURL);openWindow("mall/beforePay.htm","支付页面","",1)};_obj.innerHTML=function(b,a){b.innerHTML="";b.innerHTML=a};_obj.get=function(a){return document.getElementById(a)};_obj.show=function(c,b){if((typeof c==="string")&&c.constructor==String){c=document.getElementById(c)}if(c){var a=b==true?"block":"none";c.style.display=a}};_obj.html=function(b,a){if((typeof b==="string")&&b.constructor==String){b=document.getElementById(b)}if(b){b.innerHTML="";b.innerHTML=a}};function toOrderList(){openDelayWindow("myCenter/mallOrder/orderList.htm","订单列表","backType=stages",0)}$(document).ready(function(){_shade_layer.show("加载中,请稍候......");setTimeout(function(){_obj.load();setBackURL("mall/goodsDetail.htm","详情页","",1,"")},200)});jsHeight.bodyheight();