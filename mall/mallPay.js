var _obj={};window.onload=function(){_shade_layer.show("加载中,请稍候......");_obj.lUserId=getStringValue("lUserId");_obj.mallPayType=getQueryString("mallPayType");if(_obj.mallPayType==2){_obj.lId=getQueryString("lId");_obj.lOrderId=getQueryString("lOrderId")}else{_obj.lOrderId=getQueryString("lOrderId");_obj.strOrderSerl=getQueryString("strOrderSerl");_obj.strOrderTime=getQueryString("strOrderTime")}var a=getStringValue("strFirstMoney");_obj.strFirstMoney=Number(a)/100;$("#money_id").html(_obj.strFirstMoney);queryUserBalance()};function queryUserBalance(){var a=new CDO();a.setStringValue("strServiceName","AccountUserBIQueryService");a.setStringValue("strTransName","getAccountAmount");a.setLongValue("lUserId",Number(_obj.lUserId));raiseTrans(a,"callBackUserBalance")}function callBackUserBalance(d,e,a){if(a==null||typeof a=="undefined"){_shade_layer.hide();info("查询用户余额请求异常！");return}if(a.nCode!=0){_shade_layer.hide();info(a.strText);return}if(a.nCode==0&&e.exists("cdoAccountAmount")){var c=e.getCDOValue("cdoAccountAmount");var b=c.getStringValue("lAvailablebalance1");b=(Number(b)/100);_obj.lAccountBalance1=b;if(Number(_obj.lAccountBalance1)<Number(_obj.strFirstMoney)){$("#balance_id").html("余额<span>"+_obj.lAccountBalance1+"</span>元");document.getElementById("recharge_id").style.display="block";document.getElementById("mall_pay_id").style.display="none";document.getElementById("mall_pay_id_disabled").style.display="block"}else{$("#balance_id").html("余额<span>"+b+"</span>元");document.getElementById("recharge_id").style.display="none";document.getElementById("mall_pay_id").style.display="block";document.getElementById("mall_pay_id_disabled").style.display="none"}}_shade_layer.hide()}function goToRechargePage(){setStringValue("backURL","mall/mallPay.htm");openWindow("myCenter/recharge/financial_recharge.htm","充值页面","",0)}function payment(){if(_obj.strFirstMoney==null||typeof(_obj.strFirstMoney)=="undefined"){info("支付金额有误！");return}if(Number(_obj.lAccountBalance1)<Number(_obj.strFirstMoney)){info("用户余额不足，请充值！");return}openPayWindow("请输入支付密码","交易金额："+_obj.strFirstMoney+" 元","","",true,"callBackForIntoPass")}function callBackForIntoPass(b,a){if(a=="0"){isDisposeing=0;return false}if(_obj.mallPayType==2){payBill(b)}else{payOrder(b)}}function payOrder(a){var b=new CDO();b.setStringValue("strServiceName","OrderService");b.setStringValue("strTransName","updateOrderStateByOrderIdAndState");b.setLongValue("lOrderId",_obj.lOrderId);b.setLongValue("lBuyerId",_obj.lUserId);b.setStringValue("strOrderSerl",_obj.strOrderSerl);b.setStringValue("strOrderTime",_obj.strOrderTime);b.setStringValue("strPayPassword",a);raiseTrans(b,"callBackForPO")}function payBill(a){var b=new CDO();b.setStringValue("strServiceName","DealService");b.setStringValue("strTransName","checkOutByHand");b.setLongValue("lOrderId",_obj.lOrderId);b.setLongValue("lBuyerId",_obj.lUserId);b.setLongValue("lBillId",_obj.lId);b.setStringValue("strPayPassword",a);raiseTrans(b,"callBackForBillPay")}function callBackForPO(d,e,a){var c="";var b="";if(a==undefined||a==null){info("支付请求异常！");return false}else{if(a.nCode!=0){if(a.nCode==-50){isDisposeing=0;payPwdPutError(a.strText);return false}else{info(a.strText);return false}}}info("支付成功");clearCache();setTimeout(function(){openWindow("myCenter/mallOrder/orderList.htm","我的订单","",1)},1000)}function callBackForBillPay(b,c,a){if(a==undefined||a==null){info("通讯异常，请检查网络")}else{if(a.nCode!=0){if(a.nCode==-50){isDisposeing=0;payPwdPutError(a.strText);return false}else{info(a.strText);return false}}else{info("还款成功");setTimeout(function(){openWindow("myCenter/mallOrder/orderList.htm","我的订单","",1)},1000)}}}function clearCache(){clearArray(["strSelectAddressId"])};