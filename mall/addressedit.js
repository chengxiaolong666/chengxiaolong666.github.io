var userAddressObj={strAddressId:"",strProvince:"",strCity:"",strcounty:"",lBuyerId:0,strConsigneeName:"",strAddress:"",strMobile:""};var strFullDistrictName="";jsHeight.bodyheight();$(document).ready(function(){$("#toAddressList").click(function(){toAdressList()});$("#toOrderList").click(function(){openDelayWindow("myCenter/mallOrder/orderList.htm","订单列表","backType=addressedit",0)});$("#strIsDefault").click(function(){if($("#strIsDefault").prop("checked")!=true){$("#strIsDefault").prop("checked",true);$("#strIsDefault").attr("src","../img/public/dx_02.png")}});userAddressObj.lBuyerId=getStringValue("lUserId");userAddressObj.strAddressId=getQueryString("strAddressId");getAddressByAId(userAddressObj.strAddressId)});function getAddressByAId(a){var b=new CDO();b.setStringValue("strServiceName","AddressService");b.setStringValue("strTransName","getAddressByAId");b.setStringValue("lAddressId",a);raiseTrans(b,"callBackForGABID")}function callBackForGABID(d,h,c){if(c==undefined||c==null||c.nCode!=0){info("获取所选地址信息失败！");return false}if(h.exists("cdoAddress")){var i=h.getCDOValue("cdoAddress");if(!i.exists("lId")||!i.exists("lBuyerId")||!i.exists("strConsigneeName")||!i.exists("strMobile")||!i.exists("strFullDistrictName")||!i.exists("nIsDefault")||!i.exists("strAddress")){info("获取所选地址信息失败！");return false}var f=i.getLongValue("lId");var g=i.getStringValue("strConsigneeName");var a=i.getStringValue("strMobile");strFullDistrictName=i.getStringValue("strFullDistrictName");var b=strFullDistrictName.indexOf("|");if(b>-1){var e=strFullDistrictName.split("|");if(e.length==2){strFullDistrictName=e[0]+e[1];userAddressObj.strProvince=e[0];userAddressObj.strCity=e[1];userAddressObj.strcounty=""}if(e.length==3){strFullDistrictName=e[0]+e[1]+e[2];userAddressObj.strProvince=e[0];userAddressObj.strCity=e[1];userAddressObj.strcounty=e[2]}}jQuery("#strFullDistrictName").html(strFullDistrictName);var j=i.getStringValue("strAddress");jQuery("#strConsigneeName").val(g);jQuery("#strMobile").val(a);var k=i.getIntegerValue("nIsDefault");jQuery("#strAdress").val(j);if(k=="1"){jQuery("#strIsDefault").attr("checked","checked");jQuery("#strIsDefault").attr("src","../img/public/dx_02.png")}else{jQuery("#strIsDefault").attr("src","../img/public/dx_01.png")}jQuery("#btDel").click(function(){_TTPopups.open2({content:"您确定要删除当前地址吗？",cancelBtn:"否",submitBtn:"是",closeCallBack:"delAddress"})});jQuery("#btSave").click(function(){editAddressBefore()})}}function delAddress(b){if(b=="0"){return false}var a=new CDO();a.setStringValue("strServiceName","AddressService");a.setStringValue("strTransName","delAddressByAId");a.setStringValue("lAddressId",userAddressObj.strAddressId);raiseTrans(a,"callBackForDA")}function callBackForDA(b,c,a){if(a==undefined||a==null||a.nCode!=0){info("删除当前地址信息失败!");return false}info("删除成功！");toAdressList()}var strFullDistrictNameIn="";function editAddressBefore(){strFullDistrictNameIn=userAddressObj.strProvince+"|"+userAddressObj.strCity+"|"+userAddressObj.strcounty;userAddressObj.strAddress=jQuery("#strAdress").val();userAddressObj.strConsigneeName=jQuery("#strConsigneeName").val();userAddressObj.strMobile=jQuery("#strMobile").val();if(isVarComplete(userAddressObj.strProvince)||isVarComplete(userAddressObj.strCity)||isVarComplete(userAddressObj.strcounty)){info("区域信息有误，请从新选择！");return false}if(isVarComplete(userAddressObj.strAddress)||isVarComplete(userAddressObj.strConsigneeName)||isVarComplete(userAddressObj.strMobile)){info("请完善地址信息！");return false}userAddressObj.strMobile=richTextInputEncoder(userAddressObj.strMobile);userAddressObj.strAddress=richTextInputEncoder(userAddressObj.strAddress);jQuery("#strMobile").val(userAddressObj.strMobile);jQuery("#strAdress").val(userAddressObj.strAddress);if(isNaN(userAddressObj.strMobile)||userAddressObj.strMobile.length!=11||userAddressObj.strMobile.substr(0,1)!="1"){info("手机号格式有误！");return false}_TTPopups.open2({content:"您确定要修改当前地址吗？",cancelBtn:"否",submitBtn:"是",closeCallBack:"doEditAddress"})}function doEditAddress(c){if(c=="0"){return false}var b=jQuery("#strIsDefault").attr("checked")=="checked";var a=new CDO();a.setStringValue("strServiceName","AddressService");a.setStringValue("strTransName","updateAddressById");a.setStringValue("nAddressId",userAddressObj.strAddressId);a.setLongValue("lBuyerId",Number(userAddressObj.lBuyerId));a.setStringValue("strFullDistrictName",strFullDistrictNameIn);a.setStringValue("strAddress",userAddressObj.strAddress);a.setStringValue("strConsigneeName",userAddressObj.strConsigneeName);a.setStringValue("strMobile",userAddressObj.strMobile);if(b){a.setIntegerValue("nIsDefault",1)}else{a.setIntegerValue("nIsDefault",0)}raiseTrans(a,"callBackForEA")}function callBackForEA(c,d,a){if(a==undefined||a==null){info("修改当前地址信息失败!");return false}if(a.nCode!=0){info("修改当前地址信息失败,"+a.strText);return false}var b=userAddressObj.strAddressId;if(b!==null&&b!==undefined&&b!==""){info("修改成功！");toBeforePay(b)}else{toAdressList()}}function toAdressList(){openDelayWindow("mall/addressList.htm","地址列表","",0)}function toBeforePay(a){if(a!=""){setStringValue("strSelectAddressId",a)}openWindow("mall/beforePay.htm","订单支付","",1)};