var _obj={};_obj.choice="app_obj_payment_text font-size3 payment_row";_obj.noChoice="app_obj_payment_text";_obj.nFundSource=-1;_obj.lLenderId=-1;_obj.lLendIntentId=-1;_obj.payType="";_obj.payPwdError="";_obj.intervalTime;_obj.strOrderSn="";_obj.strBankCode="";_obj.dValue=0;_obj.kValue=0;_obj.payTypeSelf="";_obj.bankTxt="";window.onload=function(){_shade_layer.show("加载中,请稍候......");_obj.type=getStringValue("type");_obj.money=getStringValue("money");_obj.lUserId=getStringValue("lUserId");if(_obj.type==0){_obj.lAccountBalance1=0;_obj.lId=getStringValue("lId")||-1;_obj.lLenderId=getStringValue("lLenderId")||-1}else{_obj.lProductId=getStringValue("lProductId");_obj.xutouVal=getStringValue("xutouVal")||0;_obj.payType=getStringValue("payType");clearArray(["xutouVal"])}_obj.html("money_id",_obj.money);_obj.queryRemaining()};_obj.queryRemaining=function(){var a=new CDO();a.setStringValue("strServiceName","AccountUserBIQueryService");a.setStringValue("strTransName","getAccountAmount");a.setLongValue("lUserId",Number(_obj.lUserId));if(_obj.type==0){raiseTrans(a,"callBackRemaining2")}else{raiseTrans(a,"callBackRemaining")}};function callBackRemaining2(f,g,b){if(_obj.ret(b,"查询余额失败")==false){_shade_layer.hide();return}if(b.nCode==0&&g.exists("cdoAccountAmount")){var e=g.getCDOValue("cdoAccountAmount");var d=e.getStringValue("lAvailablebalance1");d=(Number(d)/100);_obj.html("draw_balance_id","<span>"+d+"</span>元");_obj.lAccountBalance1=d;var c=_obj.get("div_balance_id");c.setAttribute("choice","1");var a=_obj.get("draw_balance_id");a.className=_obj.choice}_shade_layer.hide();_obj.show("content_id",true)}function callBackRemaining(d,e,a){if(_obj.ret(a,"查询余额失败")==false){_shade_layer.hide();return false}if(a.nCode==0&&e.exists("cdoAccountAmount")){var c=e.getCDOValue("cdoAccountAmount");var b=c.getStringValue("lAvailablebalance1");b=(Number(b)/100);if(Number(b)<Number(_obj.money)){_obj.setBalanceDisabled(b)}else{_obj.yueFlag=true;_obj.html("draw_balance_id","余额<span>"+b+"</span>元")}}else{_obj.setBalanceDisabled(0)}_shade_layer.hide();_obj.queryBank()}_obj.setBalanceDisabled=function(a){var b="余额"+a+"元";var c=_obj.get("draw_balance_id");b=b+"  不可用";_obj.html(c,b);_obj.yueFlag=false};_obj.queryBank=function(){var a=new CDO();a.setStringValue("strServiceName","BorrowerService");a.setStringValue("strTransName","getBankBaseInfo");a.setLongValue("lUserId",Number(_obj.lUserId));raiseTrans(a,"callBackQueryBank")};_obj.queryBankLimit=function(b,c){var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","getThirdBankLimit");a.setLongValue("strCode",b);a.setIntegerValue("nProtocolState",c);raiseTrans(a,"callBackBankWithholdLimit")};function callBackBankWithholdLimit(b,e,a){if(_obj.ret(a,"查询银行卡失败")==false){_shade_layer.hide();return}if(a.nCode==0){var f=e.getStringValue("strDKValue");var j=e.getLongValue("lDKValue");var i=e.getStringValue("strKJValue");var g=e.getLongValue("lKJValue");_obj.dValue=j==0?9999999999:j;_obj.kValue=g==0?9999999999:j;var h=b.getIntegerValue("nProtocolState");if(h&&(h==90||h==100)){_obj.html("draw_bank_id",_obj.bankTxt);_obj.html("draw_bank_id_money",f);_obj.bankFlag=true}var c=e.getStringValue("DKEnable");var d=e.getStringValue("QPEnable");if(c=="1"){_obj.bankFlag=true}else{_obj.bankFlag=false}if(d=="1"){_obj.fastFlag=true}else{_obj.fastFlag=false}}_obj.html("draw_other_id",_obj.bankTxt);_obj.html("draw_other_id_money",i);_obj.setDefaultPitch()}function callBackQueryBank(i,c,a){_obj.bankFlag=false;if(_obj.ret(a,"查询银行卡失败")==false){_shade_layer.hide();return}if(a.nCode==0&&c.exists("cdoBank")){var g=c.getCDOValue("cdoBank");var f=g.getStringValue("nProtocolState");var b=g.getStringValue("strBankcardNo");var d=g.getStringValue("strBankName");var e=g.getStringValue("strBankCode");var b=b.substr(b.length-4,b.length);var h=d+"（"+b+"）";_obj.bankTxt=h;_obj.strBankCode=e;_obj.queryBankLimit(e,f)}}_obj.setDefaultPitch=function(){if(_obj.yueFlag==true){_obj.payTypeSelf+="0,"}if(_obj.bankFlag==true){_obj.payTypeSelf+="1,"}if(_obj.fastFlag==true){_obj.payTypeSelf+="2"}var d=["div_balance_id","div_bank_id","div_other_id"];var a=["draw_balance_id","draw_bank_id","draw_other_id"];var c=-1;for(var b=0;b<3;b++){if(_obj.payType.indexOf(b)>-1&&_obj.payTypeSelf.indexOf(b)>-1){var g=_obj.get(d[b]);(function(h){_obj.show(h,true);_obj.bindingClick(h)})(g);if(c==-1){c=b;var e=_obj.get(a[b]);if(d[b]!="div_bank_id"){_obj.show("dk_ts",false)}else{_obj.show("dk_ts",true)}var f=document.createElement("div");f.innerHTML='<img src="../img/app_correct.svg"/>';f.className="correct_svg";$(e).prepend(f);e.parentNode.setAttribute("choice","1")}c++}}if(_obj.payType.indexOf(0)==-1){_obj.show("div_balance_id",false)}_shade_layer.hide();_obj.show("content_id",true)};_obj.bindingClick=function(a){a.onclick=function(){choiceHandle(this)}};function choiceHandle(f){var h=f.id;var b=f.getAttribute("choice");if(h=="div_bank_id"){_obj.show("dk_ts",true)}else{if(h=="div_other_id"){_obj.show("dk_ts",false)}else{if(h=="div_balance_id"){_obj.show("dk_ts",false)}}}if(b=="1"){return false}var a=document.getElementsByName("z_div");for(var c=0;c<a.length;c++){var g=a[c];var e=g.id;if(e==h){var d=document.createElement("div");d.innerHTML='<img src="../img/app_correct.svg"/>';d.className="correct_svg";$(g).prepend(d);g.setAttribute("choice","1")}else{jQuery(g).find(".correct_svg").remove();g.setAttribute("choice","0")}}}_obj.payFlag=true;_obj.payStyle=function(a){if(a==true){_obj.get("pay_id").style.background="";_obj.payFlag=true}else{_obj.get("pay_id").style.background="#AAAAAA";_obj.payFlag=false}};_obj.index=0;_obj.payPwdFlag=false;_obj.pay=function(){if(!_obj.lUserId){info("用户未登录,请登录后再尝试");return false}if(_obj.payFlag==false){return false}_obj.payStyle(false);var d=document.getElementsByName("z_div");for(var b=0;b<d.length;b++){var c=d[b];var a=c.getAttribute("choice");if(a==1){_obj.nFundSource=c.getAttribute("typeVal");break}}if(_obj.nFundSource==1&&Number(_obj.money)>Number(_obj.dValue)){info("代扣支付金额超出银行卡上限!");_obj.payStyle(true);return}else{if(_obj.nFundSource==2&&Number(_obj.money)>Number(_obj.kValue)){info("快捷支付金额超出银行卡上限!");_obj.payStyle(true);return}}if(_obj.nFundSource==-1){info("请选择一种支付方式");_obj.payStyle(true);return}if(_obj.type==0){if(Number(_obj.money)>Number(_obj.lAccountBalance1)){_TTPopups.open2({content:"您的账户余额不足，请充值",cancelBtn:"取消",submitBtn:"确定",closeCallBack:"callBackOpen"});_obj.payStyle(true);return false}}if(_obj.index==0){_obj.isPayPwd()}else{_obj.index=_obj.index+1;if(_obj.payPwdFlag==true){_obj.payPwdFlag=false;openPayWindow("请输入支付密码","交易金额："+_obj.money+" 元","","",true,"callBackPaymentResult")}}_obj.payStyle(true)};function callBackFindPwd(a){if(a==1){openWindow("myCenter/securityCenter/payPwdRetrieve.htm","忘记支付密码","",1,"")}_obj.payStyle(true)}function callBackOpen(a){if(a==1){_obj.goVoucher()}else{_obj.payStyle(true)}}_obj.goVoucher=function(){openWindow("myCenter/recharge/financial_recharge.htm","充值页面","",0)};_obj.isPayPwd=function(){var a=new CDO();a.setStringValue("strServiceName","CustomerService");a.setStringValue("strTransName","queryIsSetPayPwd");a.setLongValue("lUserId",Number(_obj.lUserId));raiseTrans(a,"callBackIsPayPwd")};function callBackIsPayPwd(c,d,a){if(_obj.ret(a,"查询是否有支付密码失败")==false){_obj.payStyle(true);return}if(a.nCode==0&&d.exists("nIsSetPayPwd")){var b=d.getIntegerValue("nIsSetPayPwd");if(b==0){_obj.setPayPwd()}else{if(b==1){_obj.index=_obj.index+1;openPayWindow("请输入支付密码","交易金额：￥"+_obj.money+" 元","","",true,"callBackPaymentResult")}}}}_obj.setPayPwd=function(){_TTPopups.open2({content:"您没有设置支付密码,去设置",cancelBtn:"取消",submitBtn:"确定",closeCallBack:"callBackOpenPay"})};function callBackOpenPay(a){if(a==1){openWindow("myCenter/securityCenter/payPwdSet.htm","设置支付密码","",0)}else{_obj.payStyle(true)}}function callBackPaymentResult(b,a){if(a==0){_obj.payStyle(true)}else{_obj.verifyPwd(b)}_obj.payPwdFlag=true}_obj.verifyPwd=function(b){if(b&&b.length==0){info("请输入密码后再确定");return}_obj.strMD5Pass=b;var a=new CDO();a.setStringValue("strServiceName","CustomerService");a.setStringValue("strTransName","verifyPayPassword");a.setLongValue("lUserId",Number(_obj.lUserId));a.setStringValue("strPayPassword",b);raiseTrans(a,"callBackVerifyPwd")};function callBackVerifyPwd(b,d,a){var c=b.getStringValue("strPayPassword");if(a==undefined||a==null){info("验证密码请求失败");_obj.payStyle(true);return false}if(a.nCode!=0&&a.nCode!=1){info(a.strText);_obj.payStyle(true);return false}if(a.nCode==1){_obj.payPwdError=a.strText;payPwdPutError(a.strText);_obj.payStyle(true);return false}if(a.nCode==0){_shade_layer.show("支付中,请稍候......");_obj.paymentMonery(c)}}_obj.paymentMonery=function(b){var a=new CDO();if(_obj.type==0){a.setStringValue("strServiceName","LendIntentService");a.setStringValue("strTransName","undertakeRedemption");a.setLongValue("lId",Number(_obj.lId));a.setLongValue("lAmount",(Number(_obj.money)*100));a.setIntegerValue("nFundSource",0);a.setLongValue("lLenderId",Number(_obj.lLenderId));a.setStringValue("strPayPassword",b);raiseTrans(a,"callBackBuy")}else{a.setStringValue("strServiceName","LendIntentService");a.setStringValue("strTransName","addLendIntentForMobile");a.setIntegerValue("nFundSource",Number(_obj.nFundSource));a.setStringValue("lLendProductId",_obj.lProductId);a.setLongValue("lAmount",(Number(_obj.money)*100));a.setIntegerValue("nContinue",Number(_obj.xutouVal));a.setStringValue("strPayPassword",b);raiseTrans(a,"callBackBuy")}_obj.payStyle(true)};function callBackBuy(e,f,b){if(b==null||typeof b=="undefined"){info("购买出现错误");_shade_layer.hide();_obj.payStyle(true);return false}if(b.nCode==-90000){info(b.strText);_shade_layer.hide();_obj.payStyle(true);return}if(b.nCode==0){if(_obj.nFundSource==2){_shade_layer.hide();var a=f.getStringValue("strDealSN");var d=f.getStringValue("lLenderId");var c=f.getStringValue("lLendIntentId");_obj.lLendIntentId=c;setStringValue("lLenderId",d+"");setStringValue("lLendIntentId",c+"");setStringValue("payTypeTo","1");_obj.strOrderSn=a;setStringValue("strOrderSn",a);setTimeout(function(){_obj.callKuaijie()},1000)}else{_shade_layer.hide();_obj.toResult()}}else{if(b.nCode==-2){_TTPopups.open2({content:"产品已售完",cancelBtn:"取消",submitBtn:"投资其他",closeCallBack:"callBackInvestOther"})}else{var g=b.strText;_TTPopups.open2({content:g,cancelBtn:"取消",submitBtn:"投资其他",closeCallBack:"callBackInvestOther"})}_shade_layer.hide()}_shade_layer.hide()}function callBackInvestOther(a){if(a==1){openWindow("lend/productList.htm","产品超市","",0)}else{_shade_layer.hide();_obj.payStyle(true)}}_obj.toResult=function(){setTimeout(function(){var a=getQueryString("dPage");openWindow("lend/result.htm","支付结果页","dPage="+a,0)},200)};_obj.callKuaijie=function(){var a=new CDO();a.setStringValue("strServiceName","LendIntentService");a.setStringValue("strTransName","cycleFastPayment");a.setLongValue("lLendIntentId",_obj.lLendIntentId);raiseTrans(a,"callBackOrderKuaijie")};function callBackOrderKuaijie(b,c,a){if(a==null||typeof a=="undefined"){info("通讯失败");_shade_layer.hide();return false}if(a.nCode==-90000){info(a.strText);_shade_layer.hide();return}if(a.nCode==0){setTimeout(function(){var d=getQueryString("dPage");setStringValue("strOrderSn",_obj.strOrderSn);openWindow("myCenter/recharge/financial_code.htm","快捷支付","strOrderSn="+_obj.strOrderSn+"&dPage="+d+"",0)},200)}else{if(a.nCode==1){setTimeout(function(){_obj.callKuaijie()},200)}else{info(a.strText);return}}_shade_layer.hide()}_obj.ret=function(a,c){try{if(a==null||typeof a=="undefined"){info(c);return false}if(a.nCode!=0){info(a.strText);return false}return true}catch(b){info(b)}return false};_obj.get=function(a){return document.getElementById(a)};_obj.show=function(c,b){if((typeof c==="string")&&c.constructor==String){c=document.getElementById(c)}if(c){var a=b==true?"block":"none";c.style.display=a}};_obj.html=function(b,a){if((typeof b==="string")&&b.constructor==String){b=document.getElementById(b)}if(b){b.innerHTML="";b.innerHTML=a}};