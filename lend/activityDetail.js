var _obj={};_obj.rate=0;_obj.nDayUnit;_obj.nDayCount;_obj.productName="";_obj.lAccountBalance1=0;_obj.xieyiVal=1;_obj.goPage=1;_obj.payType="";_obj.maxMoney=0;_obj.strPreSalesTime="";_obj.time="";_obj.lProductId="-1";_obj.nowTime="";_obj.nProtocolState="";_obj.setProtocolIndex=-1;_obj.money=0;window.onload=function(){_shade_layer.show("加载中,请稍候......");_obj.productBackURL=getStringValue("productBackURL");setBackURL(_obj.productBackURL,"","",1,"","1");_obj.lId=getStringValue("lId");_obj.lUserId=getStringValue("lUserId");_obj.remaining();_obj.loadRightsDetail();setStringValue("productType","1")};_obj.loadRightsDetail=function(){if(!_obj.lId){info("系统错误!");return false}var a=new CDO();a.setStringValue("strServiceName","LendProductService");a.setStringValue("strTransName","getDeptLendProductByIdForMobile");a.setLongValue("lId",Number(_obj.lId));raiseTrans(a,"callBackRightsDetail")};function callBackRightsDetail(A,C,g){if(_obj.ret(g,"获取详情失败")==false){return false}if(g.nCode==0&&C.exists("cdoRecord")){var f=C.getCDOValue("cdoRecord");var m=f.getStringValue("nDayUnit");var w=Number(f.getStringValue("nDayCount"));var E=f.getIntegerValue("nLenderYearRate");var a=f.getIntegerValue("nLendExtRate");var e=f.getLongValue("lMinInvestAmount");var v=f.getLongValue("lLimitAmount")||0;var i=f.getLongValue("lPreSalesAmount")||0;var B=f.getLongValue("lPeriodAmount")||0;var p=f.getIntegerValue("nInvPersonCount")||0;var o=f.getStringValue("strName");var h=f.getStringValue("strEndDate");var D=f.getStringValue("strPreSalesTime");_obj.nowTime=f.getStringValue("dtNow");var d=0;if(v!=0){d=_obj.getMoney(v-i,0)}var c=(Number(i/v||0)*100).toFixed(2)||0;var j=m=="2"?"年":(m=="1"?"月":"天");var k="";var l="";if(a&&a>0){k="+"+parseFloat((a/100).toFixed(2))+"%";l=E+a}else{l=E}var r="";if(v>0){var n=Number(d).toFixed(0)+" 元";var y=String(_obj.getMoney(v,0))+"  元";if(h&&h.length>0){r="<li>发售金额：<label>"+y+'</label></li><li style="float:right;padding-right:5%;">剩余可投金额：<label>'+n+"</label></li><li>售卖截止时间："+h+"</li>"}else{r="<li>发售金额：<label>"+y+'</label></li><li style="float:right;padding-right:5%;">剩余可投金额：<label>'+n+"</label></li>"}}else{_obj.show("progress_div_id",false)}_obj.html("strLendProductName_id",o);_obj.html("nLenderYearRate_id",f.getStringValue("strDisplayRate")+'<span class="bfb">'+k+"</span>");_obj.html("transfer_txt_id",r);_obj.html("deadline_id",w+j);_obj.html("people_id",p);_obj.html("invst_plan_scale",c+"%");_obj.get("invst_plan_bl").style.width=c+"%";$("#transfer_txt_id").find("li").css("color","#FFF");_obj.lMinInvestAmount=_obj.getMoney(e,0)||0;_obj.nDayCount=w;_obj.nDayUnit=m;_obj.rate=Number(l/10000).toFixed(4);_obj.productName=o;_obj.strPreSalesTime=D;_obj.lProductId=f.getStringValue("lId");var z=_obj.getMoney(B,0);if(Number(d)==0){_obj.maxMoney=z}else{if(Number(z)>Number(d)){_obj.maxMoney=d}else{_obj.maxMoney=z}}if(_obj.maxMoney==0){_obj.maxMoney=9999999}var b="起投金额"+_obj.lMinInvestAmount+"元";_obj.get("lMinInvestAmount_id").setAttribute("placeholder",b);_obj.hint(_obj.getMoney(e));if(f.exists("cdosLendProductPaymentType")){var q=f.getCDOArrayValue("cdosLendProductPaymentType");for(var u=0;u<q.length;u++){_obj.payType+=q[u].getStringValue("strPaymentTypeCode")+","}}if(!D||D.length==0){_obj.show("buy_id",true)}else{var x=_obj.timeDiff(_obj.strPreSalesTime);if(x<=0){_obj.show("buy_id",true)}else{_obj.time=setInterval(function(){_obj.ShowCountDown(_obj.strPreSalesTime)},950)}}}else{var F=getStringValue("titleName");if(F&&F.length>0){F=decodeURI(F);_obj.html("strLendProductName_id",F)}_Not.show("mui-content_id","该产品已停用");_obj.show("mui-content_id",true);_shade_layer.hide();return false}setTimeout(function(){_shade_layer.hide();_obj.show("mui-content_id",true);jsHeight.bodyheight("mrys_bag")},1000)}_obj.ShowCountDown=function(a){var j=_obj.timeDiff(a);var i=false;var k=Math.floor(j/(24*3600*1000));var f="距离开售：";if(k>0){f=f+k+"天";window.clearInterval(_obj.time)}else{var e=j%(24*3600*1000);var g=Math.floor(e/(3600*1000));var d=e%(3600*1000);var b=Math.floor(d/(60*1000));var c=d%(60*1000);s=Math.round(c/1000);if(g>0){f=f+g+"小时 "+b+" 分钟"+s+" 秒"}else{if(b>0){f=f+b+" 分钟"+s+" 秒"}else{if(s==0){i=true}f=f+s+" 秒"}}}_obj.nowTime=_obj.addTime(_obj.nowTime,1);if(i==true){_obj.show("buy_time_id",false);_obj.show("buy_id",true);window.clearInterval(_obj.time)}else{_obj.html("buy_time_id",f);_obj.show("buy_time_id",true)}};_obj.timeDiff=function(f){var c=(_obj.nowTime).replace(/-/g,"/");var a=(f).replace(/-/g,"/");var e=new Date(c);var d=new Date(a);var b=d.getTime()-e.getTime();return b};_obj.addTime=function(d,c){var e=d.replace(/-/g,"/");var b=new Date(e);b.setTime(b.getTime()+c*1000);var a=b.format("yyyy-MM-dd hh:mm:ss");return a};_obj.getMoney=function(b,a){return Number(Number(b)/100).toFixed(a)||0};_obj.remaining=function(){var a=new CDO();a.setStringValue("strServiceName","AccountUserBIQueryService");a.setStringValue("strTransName","getAccountAmount");a.setLongValue("lUserId",Number(_obj.lUserId));raiseTrans(a,"callBackRemaining")};function callBackRemaining(d,e,a){if(_obj.ret(a,"查询余额失败")==false){return false}if(a.nCode==0&&e.exists("cdoAccountAmount")){var c=e.getCDOValue("cdoAccountAmount");var b=c.getStringValue("lAvailablebalance1");_obj.html("balance_money_id",b/100);_obj.lAccountBalance1=b/100}else{info(a.strText)}}_obj.hint=function(a){var b=0;if(_obj.nDayUnit=="2"){b=Number(a*_obj.rate*_obj.nDayCount).toFixed(2)}else{if(_obj.nDayUnit=="1"){b=Number(numMulti(a*_obj.rate/12,_obj.nDayCount)).toFixed(2)}else{b=Number(numMulti(a*_obj.rate/365,_obj.nDayCount)).toFixed(2)}}if(a==null||a==""){a=0}_obj.html("hint_id","如您投资"+a+"元，预估收益："+b+"元，次日计息")};function numMulti(d,b){var a=0;try{a+=d.toString().split(".")[1].length}catch(c){}try{a+=b.toString().split(".")[1].length}catch(c){}return Number(d.toString().replace(".",""))*Number(b.toString().replace(".",""))/Math.pow(10,a)}_obj.inputMoney=function(b){var a=/^[1-9]{1}\d*$/g;var c=b.value;if(c.length>0){if(!a.test(c)){c=0;info("请输入数字类型");b.value="";_obj.hint(c);return false}}if(Number(c)>Number(_obj.maxMoney)){info("金额不能超过"+_obj.maxMoney+"元");c=0;b.value="";_obj.hint(c);return false}_obj.hint(c);return true};_obj.changePic=function(a){var b=a.src;if(b.indexOf("dx_02.png")>-1){_obj.xieyiVal=0;a.src="../img/public/dx_01.png"}else{_obj.xieyiVal=1;a.src="../img/public/dx_02.png"}};_obj.buyFlag=true;_obj.buyStyle=function(a){if(a==true){_obj.get("buy_id").style.display="block";_obj.get("buy_in_id").style.display="none";_obj.payFlag=true}else{_obj.get("buy_id").style.display="none";_obj.get("buy_in_id").style.display="block";_obj.payFlag=false}};_obj.buy=function(){javascript:scrollTo(0,0);_obj.goPage=1;if(_obj.payFlag==false){return false}var a=_obj.buyingVerify();if(a==false){_obj.buyStyle(true);return false}_obj.realNameIde();_obj.buyStyle(false)};_obj.buying=function(){setStringValue("lProductId",_obj.lProductId);setStringValue("money",_obj.money+"");setStringValue("type","1");setStringValue("payType",_obj.payType);setStringValue("xutouVal","0");openWindow("lend/pay.htm","支付页面","dPage=activityDetail.htm",0);_obj.buyStyle(true);_shade_layer.hide()};_obj.buyingVerify=function(){var b=_obj.get("lMinInvestAmount_id").value||0;var a=Number(b)%100==0;if(a==false){info("请输入100的整数倍金额");return false}if(Number(b)<Number(_obj.lMinInvestAmount)){info("请输入不小于"+_obj.lMinInvestAmount+"元的投资金额");_obj.buyStyle(true);return false}if(_obj.xieyiVal==0){info("请同意协议");return false}_obj.money=b;return true};function callBackOpen(a){if(a==1){_obj.goVoucher()}else{_obj.buyStyle(true)}}_obj.realNameIde=function(){var a=new CDO();a.setStringValue("strServiceName","CommonService");a.setStringValue("strTransName","queryIdentityOrPayPwd");a.setLongValue("lUserId",Number(_obj.lUserId));raiseTrans(a,"callBackRealNameIde")};function callBackRealNameIde(d,f,a){if(_obj.ret(a,"查询是否实名认证失败")==false){_obj.buyStyle(true);_shade_layer.hide();return}if(a.nCode==0&&f.exists("nIdentityState")){var c=f.getIntegerValue("nIdentityState");var e=f.exists("nProtocolState")?f.getIntegerValue("nProtocolState"):10;_obj.nProtocolState=e;if(c==90||c==100){var b=f.getIntegerValue("nIsSetPayPwd");if(b==0){_obj.setPayPwd()}else{if(b==1){if(e==90||e==100||e==20){_obj.buying();return}_obj.goProtocolPage(e)}}}else{_obj.goIdenPage(c)}}_obj.buyStyle(true);_shade_layer.hide()}_obj.goIdenPage=function(a){if(a==10){_TTPopups.open2({content:"您未实名认证，请认证",cancelBtn:"否",submitBtn:"是",closeCallBack:"TT_pay_sm_1"})}else{if(a==20){info("您的实名认证正在认证中，请稍候查看实名认证");_obj.buyStyle(true)}else{if(a==30){_TTPopups.open2({content:"您的实名认证失败,查看原因",cancelBtn:"否",submitBtn:"是",closeCallBack:"TT_pay_sm_2"})}}}};function TT_pay_sm_1(a){if(a==1){openWindow("myCenter/securityCenter/accountIdCard.htm","实名认证","clearUser=1&nIdentityState=10",1)}_obj.buyStyle(true)}function TT_pay_sm_2(a){if(a==1){openWindow("myCenter/securityCenter/accountIdCard.htm","实名认证","clearUser=1&nIdentityState=30",1)}_obj.buyStyle(true)}_obj.goProtocolPage=function(a){if(a==10){_TTPopups.open2({content:"投资前需要签约代扣协议",cancelBtn:"取消",submitBtn:"前往",closeCallBack:"TT_pay_dk_1"});return false}};function TT_pay_dk_1(a){if(a==1){callProtocol(1,"","lend/activityDetail.htm")}_obj.buyStyle(true)}_obj.goVoucherBefore=function(){checkIsPayPwd("_obj.goVoucher")};_obj.goVoucher=function(){setStringValue("backURL","lend/activityDetail.htm");openWindow("myCenter/recharge/financial_recharge.htm","充值页面","",0)};_obj.loadInvestList=function(){var a=_obj.productName;a=encodeURI(a);setStringValue("lId",_obj.lId);setStringValue("productName",a);setStringValue("investListType","1");openWindow("lend/investList.htm","投资记录","",0)};_obj.setPayPwd=function(){_TTPopups.open2({content:"您没有设置支付密码,去设置",cancelBtn:"取消",submitBtn:"确定",closeCallBack:"callBackOpenPay"})};function callBackOpenPay(a){if(a==1){_obj.buyStyle(true);setTimeout(function(){openWindow("myCenter/securityCenter/payPwdSet.htm","设置支付密码","",0)},300)}else{_obj.buyStyle(true)}}Date.prototype.format=function(b){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(b)){b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in c){if(new RegExp("("+a+")").test(b)){b=b.replace(RegExp.$1,RegExp.$1.length==1?c[a]:("00"+c[a]).substr((""+c[a]).length))}}return b};_obj.ret=function(a,b){if(a==null||typeof a=="undefined"){info(b);return false}if(a.nCode!=0){info("错误："+a.strText);return false}};_obj.get=function(a){return document.getElementById(a)};_obj.show=function(c,b){if((typeof c==="string")&&c.constructor==String){c=document.getElementById(c)}if(c){var a=b==true?"block":"none";c.style.display=a}};_obj.html=function(b,a){if((typeof b==="string")&&b.constructor==String){b=document.getElementById(b)}if(b){b.innerHTML="";b.innerHTML=a}};_obj.back=function(){openDelayWindow(_obj.productBackURL,"产品超时","","1","lend/activityDetail.htm","1")};