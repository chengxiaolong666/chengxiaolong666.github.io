var _lUserId="";var _phone="";jsHeight.bodyheight();window.onload=function(){_lUserId=getStringValue("lUserId");_phone=getStringValue("strMobile");setBackURL("index.htm","首页","",1,"")};document.getElementById("atAdd").addEventListener("click",function(){openDeviceContactpersonView()});document.getElementById("reAdd").addEventListener("click",function(){openDeviceContactpersonView()});document.getElementById("addNext").addEventListener("click",function(){openWindow("applyCredit/borrow_04.htm","信审状态","",0)});var checkPerson=function(){var a=new CDO();a.setStringValue("strServiceName","UserService");a.setStringValue("strTransName","getMassiveUserInfo");a.setLongValue("lUserId",Number(_lUserId));raiseTrans(a,"callBackPhoneAuthenState")};function callBackPhoneAuthenState(c,d,b){if(b==undefined||b==null){info("请求查询紧急联系人失败!");return false}if(b.nCode==-90000){info(b.strText);return false}if(b.nCode==0){if(d.exists("cdoUser")){var a=d.getCDOValue("cdoUser");var e=a.exists("nContactNum")?a.getIntegerValue("nContactNum"):0;if(e!=0){_credit.getCreditInfo()}else{openWindow("applyCredit/borrow_03.htm","添加联系人","",0)}}else{info("获取紧急联系人数据错误");openWindow("applyCredit/borrow_03.htm","添加联系人","",0)}}else{info(b.strText);openWindow("applyCredit/borrow_03.htm","添加联系人","",0)}}function step1(){var c=document.getElementById("result_content");c.style.display="block";var f=document.getElementById("result_success");f.style.display="block";var d=document.getElementById("atAdd");d.style.display="none";var a=document.getElementById("reAdd");a.style.display="block";var e=document.getElementById("addNext");e.style.display="block";var b=document.getElementById("result_fail");b.style.display="none"}function step2(){var c=document.getElementById("result_content");c.style.display="block";var b=document.getElementById("result_fail");b.style.display="block";var a=document.getElementById("reAdd");a.style.display="block";var f=document.getElementById("result_success");f.style.display="none";var e=document.getElementById("addNext");e.style.display="none";var d=document.getElementById("atAdd");d.style.display="none"}function openDeviceContactpersonView(){var b=document.getElementById("result_content");b.style.display="none";var d=document.getElementById("result_success");d.style.display="none";var a=document.getElementById("result_fail");a.style.display="none";var c=document.getElementById("addNext");c.style.display="none";EngineClass.openContacts("callBackOpenContacts","0")}var callBackOpenContacts=function(c,b,a,e){if(c!=null&&c!="null"&&c!=""){addLinkMan(c,e)}else{var d=document.getElementById("result_content");d.innerHTML="无法添加联系人,请确认是否开启获取联系人权限！<br />或者联系人电话为空!";d.style.display="block"}};function addLinkMan(c,f){_shade_layer.show("正在处理中,请稍候...");var g=getStringValue("lUserId");var a=getStringValue("strName");var d=document.getElementById("strName");d.innerHTML=f;var b=document.getElementById("strPhone");b.innerHTML=c;setTimeout(function(){backupData("",_phone,Number(g),1)},10);var e=new CDO();e.setStringValue("strServiceName","UserService");e.setStringValue("strTransName","createErgentContact");e.setLongValue("lUserId",Number(g));e.setStringValue("strCustomerName",a);e.setStringValue("strMobile",_phone);e.setStringValue("strName",f);e.setStringValue("strTel",c);raiseTrans(e,"callBackAddLinkman")}function callBackAddLinkman(b,c,a){if(a==undefined||a==null){info("请求添加紧急联系人失败!");_shade_layer.hide();return false}if(a.nCode==-90000){info(a.strText);_shade_layer.hide();return false}if(a.nCode==0){setTimeout(function(){step1();var d=a.strText;var e=document.getElementById("result_content");e.innerHTML="添加成功!";e.style.fontSize="1.5em";e.style.fontWeight="bold";e.style.marginTop="1.5em";_shade_layer.hide()},3000)}else{setTimeout(function(){step2();var f=a.strText;var d=document.getElementById("result_content");d.innerHTML="添加失败!";d.style.fontSize="1.5em";d.style.fontWeight="bold";d.style.marginTop="1.5em";var e=document.getElementById("fail_content");e.innerHTML=f;_shade_layer.hide()},3000)}}function backIndex(){openWindow("index.htm","首页","",1,"",1)};